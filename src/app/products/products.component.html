<div class="shop-page">
  <!-- Main Content -->
  <section class="shop-main-section">
    <div class="container">
      <div class="shop-layout">
        <!-- Sidebar Filters -->
        <aside class="filter-sidebar">
          <div class="filter-card">
            <div class="filter-header">
              <h3>Filters</h3>
              <button class="clear-filters" (click)="clearFilters()">Clear All</button>
            </div>
            
            <div class="filter-section">
              <h4>Price Range</h4>
              <div class="price-range">
                <div class="range-slider">
                  <input type="range" min="0" max="1000" step="50" 
                        [(ngModel)]="filters.priceRange" 
                        (input)="applyFilters()"
                        class="slider">
                  <div class="price-display">$0 - ${{filters.priceRange}}</div>
                </div>
              </div>
            </div>

            <div class="filter-section">
              <h4>Pet Type</h4>
              <div class="category-filters">
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.breeds.dog" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Dogs</span>
                  <span class="product-count">({{getProductCountByBreed('Dog')}})</span>
                </label>
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.breeds.cat" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Cats</span>
                  <span class="product-count">({{getProductCountByBreed('Cat')}})</span>
                </label>
              </div>
            </div>

            <div class="filter-section">
              <h4>Deals & Offers</h4>
              <div class="category-filters">
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.deals.hotSale" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Hot Sale</span>
                </label>
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.deals.bestseller" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Bestseller</span>
                </label>
              </div>
            </div>

            <div class="filter-section">
              <h4>Material</h4>
              <div class="category-filters">
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.materials.glass" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Glass</span>
                </label>
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.materials.wood" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Wood</span>
                </label>
                <label class="filter-checkbox">
                  <input type="checkbox" [(ngModel)]="filters.materials.plastic" (change)="applyFilters()">
                  <span class="checkmark"></span>
                  <span class="filter-label">Plastic</span>
                </label>
              </div>
            </div>

            <div class="filter-section">
              <h4>Rating</h4>
              <div class="rating-filters">
                <label class="rating-option">
                  <input type="radio" name="rating" value="5" [(ngModel)]="filters.minRating" (change)="applyFilters()">
                  <span class="stars">★★★★★</span>
                  <span class="rating-count">(128)</span>
                </label>
                <label class="rating-option">
                  <input type="radio" name="rating" value="4" [(ngModel)]="filters.minRating" (change)="applyFilters()">
                  <span class="stars">★★★★☆</span>
                  <span class="rating-count">(64)</span>
                </label>
                <label class="rating-option">
                  <input type="radio" name="rating" value="0" [(ngModel)]="filters.minRating" (change)="applyFilters()">
                  <span class="stars">Any Rating</span>
                </label>
              </div>
            </div>
          </div>
        </aside>

        <!-- Products Grid -->
        <main class="products-main">
          <div class="products-header">
            <div class="header-top">
              <div class="header-content">
                <h2>Our Products</h2>
                <p>{{filteredProducts.length}} premium products for your furry companions</p>
              </div>
            </div>
            
            <div class="header-actions">
              <div class="mobile-actions-row">
                <!-- Mobile Filter Button -->
                <button class="mobile-filter-toggle" (click)="toggleMobileFilters()">
                  <i class="fas fa-filter"></i>
                  Filters
                </button>
                
                <!-- Mobile Sort Button -->
                <button class="mobile-sort-toggle" (click)="toggleMobileSort()">
                  <i class="fas fa-sort"></i>
                  Sort
                </button>
                
                <!-- Add Product Button (Admin only) -->
                <button
                  class="add-product-btn"
                  *ngIf="isAdmin()"
                  (click)="openAddProductModal()"
                >
                  <i class="fas fa-plus"></i>
                  Add Product
                </button>
              </div>
              
              <!-- Desktop Sort Options (hidden on mobile) -->
              <div class="sort-options">
                <select class="sort-select" [(ngModel)]="sortOption" (change)="applySorting()">
                  <option value="featured">Sort by: Featured</option>
                  <option value="priceLow">Price: Low to High</option>
                  <option value="priceHigh">Price: High to Low</option>
                  <option value="name">Name: A to Z</option>
                  <option value="rating">Highest Rating</option>
                </select>
              </div>
            </div>
          </div>

          <div class="products-grid">
            <div class="product-card" *ngFor="let product of paginatedProducts">
              <!-- Admin Controls -->
              <div class="admin-controls" *ngIf="isAdmin()">
                <button class="admin-btn edit-btn" (click)="editProduct(product, $event)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="admin-btn delete-btn" (click)="deleteProduct(product.id, $event)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              
              <div class="product-image" (click)="openProductModal(product)">
                <img [src]="product.image" [alt]="product.model" (load)="onImageLoad($event)" (error)="onImageError($event)">
                <div class="product-tags">
                  <span class="tag hot-sale" *ngIf="product.deals === 'Hot Sale'">Hot Sale</span>
                  <span class="tag bestseller" *ngIf="product.deals === 'Bestseller'">Bestseller</span>
                </div>
                <div class="product-overlay">
                  <button class="quick-view-btn">Quick View</button>
                </div>
              </div>
              <div class="product-info">
                <h3 class="product-model">{{ product.model }}</h3>
                <p class="product-description">{{ product.product_info }}</p>
                <div class="product-meta">
                  <div class="product-price">${{ product.price }}</div>
                  <div class="product-reviews">
                    <span class="stars" [innerHTML]="generateStars(product.reviews)"></span>
                    <span class="review-count">({{ getRatingNumber(product.reviews) }})</span>
                  </div>
                </div>
                <div class="product-breed">
                  <i class="fas fa-paw"></i>
                  {{ product.breed }}
                </div>
                <div class="product-stock" *ngIf="isAdmin()">
                  <i class="fas fa-box"></i>
                  Stock: {{ product.quantity }}
                </div>
                <button class="add-to-cart-mini" (click)="onAddToCartClick(product, $event)">
                  <i class="fas fa-shopping-cart"></i>
                  Add to Cart
                </button>
              </div>
            </div>
          </div>

          <!-- No Results Message -->
          <div class="no-results" *ngIf="filteredProducts.length === 0">
            <i class="fas fa-search"></i>
            <h3>No products found</h3>
            <p>Try adjusting your filters to see more results</p>
            <button class="clear-filters-btn" (click)="clearFilters()">Clear All Filters</button>
          </div>

          <!-- Pagination -->
          <div class="pagination" *ngIf="filteredProducts.length > 0 && !isMobileView">
            <button 
              class="pagination-btn prev" 
              [disabled]="currentPage === 1"
              (click)="previousPage()">
              <i class="fas fa-chevron-left"></i>
              Previous
            </button>
            
            <div class="page-numbers">
              <span class="current-page">{{ currentPage }}</span>
              <span class="total-pages">of {{ totalPages }}</span>
            </div>
            
            <button 
              class="pagination-btn next" 
              [disabled]="currentPage === totalPages"
              (click)="nextPage()">
              Next
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </main>
      </div>
    </div>
  </section>

  <!-- Mobile Filter Sidebar -->
  <div class="filter-overlay" [class.active]="isMobileFiltersOpen" (click)="closeMobileFilters()"></div>
  <div class="filter-sidebar-mobile" [class.active]="isMobileFiltersOpen">
    <div class="filter-card">
      <div class="filter-header">
        <h3>Filters</h3>
        <button class="close-filters" (click)="closeMobileFilters()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Price Range -->
      <div class="filter-section">
        <h4><i class="fas fa-tag"></i> Price Range</h4>
        <div class="price-range">
          <div class="range-slider">
            <input type="range" min="0" max="1000" step="50" 
                  [(ngModel)]="filters.priceRange" 
                  (input)="applyFilters()"
                  class="slider">
            <div class="price-display">$0 - ${{filters.priceRange}}</div>
          </div>
        </div>
      </div>

      <!-- Pet Type -->
      <div class="filter-section">
        <h4><i class="fas fa-paw"></i> Pet Type</h4>
        <div class="category-filters">
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.breeds.dog" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Dogs</span>
            <span class="product-count">({{getProductCountByBreed('Dog')}})</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.breeds.cat" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Cats</span>
            <span class="product-count">({{getProductCountByBreed('Cat')}})</span>
          </label>
        </div>
      </div>

      <!-- Deals & Offers -->
      <div class="filter-section">
        <h4><i class="fas fa-bolt"></i> Deals & Offers</h4>
        <div class="category-filters">
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.deals.hotSale" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Hot Sale</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.deals.bestseller" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Bestseller</span>
          </label>
        </div>
      </div>

      <!-- Material -->
      <div class="filter-section">
        <h4><i class="fas fa-cube"></i> Material</h4>
        <div class="category-filters">
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.materials.glass" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Glass</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.materials.wood" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Wood</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filters.materials.plastic" (change)="applyFilters()">
            <span class="checkmark"></span>
            <span class="filter-label">Plastic</span>
          </label>
        </div>
      </div>

      <!-- Rating -->
      <div class="filter-section">
        <h4><i class="fas fa-star"></i> Rating</h4>
        <div class="rating-filters">
          <label class="rating-option">
            <input type="radio" name="rating" value="5" [(ngModel)]="filters.minRating" (change)="applyFilters()">
            <span class="stars">★★★★★</span>
            <span class="rating-count">(128)</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="4" [(ngModel)]="filters.minRating" (change)="applyFilters()">
            <span class="stars">★★★★☆</span>
            <span class="rating-count">(64)</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="0" [(ngModel)]="filters.minRating" (change)="applyFilters()">
            <span class="stars">Any Rating</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Sort Modal -->
  <div class="sort-overlay" [class.active]="isMobileSortOpen" (click)="closeMobileSort()"></div>
  
  <div class="sort-sidebar-mobile" [class.active]="isMobileSortOpen">
    <div class="sort-card">
      <div class="sort-header">
        <h3>Sort By</h3>
        <button class="close-sort" (click)="closeMobileSort()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="sort-options-mobile">
        <label class="sort-option">
          <input type="radio" name="mobileSort" value="featured" [(ngModel)]="sortOption" (change)="applySorting(); closeMobileSort()">
          <span class="sort-checkmark"></span>
          <span class="sort-label">Featured</span>
        </label>
        
        <label class="sort-option">
          <input type="radio" name="mobileSort" value="priceLow" [(ngModel)]="sortOption" (change)="applySorting(); closeMobileSort()">
          <span class="sort-checkmark"></span>
          <span class="sort-label">Price: Low to High</span>
        </label>
        
        <label class="sort-option">
          <input type="radio" name="mobileSort" value="priceHigh" [(ngModel)]="sortOption" (change)="applySorting(); closeMobileSort()">
          <span class="sort-checkmark"></span>
          <span class="sort-label">Price: High to Low</span>
        </label>
        
        <label class="sort-option">
          <input type="radio" name="mobileSort" value="name" [(ngModel)]="sortOption" (change)="applySorting(); closeMobileSort()">
          <span class="sort-checkmark"></span>
          <span class="sort-label">Name: A to Z</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Product Modal -->
  <div class="modal-overlay" *ngIf="selectedProduct" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="modal-product">
        <div class="modal-image">
          <img [src]="selectedProduct.image" [alt]="selectedProduct.model">
          <div class="modal-tags">
            <span class="tag hot-sale" *ngIf="selectedProduct.deals === 'Hot Sale'">Hot Sale</span>
            <span class="tag bestseller" *ngIf="selectedProduct.deals === 'Bestseller'">Bestseller</span>
          </div>
        </div>
        
        <div class="modal-details">
          <div class="modal-header">
            <h2>{{ selectedProduct.model }}</h2>
            <div class="modal-price">${{ selectedProduct.price }}</div>
          </div>
          
          <p class="product-info">{{ selectedProduct.product_info }}</p>
          
          <div class="modal-specs">
            <div class="spec-item">
              <i class="fas fa-paw"></i>
              <div class="spec-content">
                <span class="spec-label">Pet Type</span>
                <span class="spec-value">{{ selectedProduct.breed }}</span>
              </div>
            </div>
            <div class="spec-item">
              <i class="fas fa-box"></i>
              <div class="spec-content">
                <span class="spec-label">In Stock</span>
                <span class="spec-value">{{ selectedProduct.quantity }} units</span>
              </div>
            </div>
            <div class="spec-item">
              <i class="fas fa-shipping-fast"></i>
              <div class="spec-content">
                <span class="spec-label">Delivery</span>
                <span class="spec-value">Free Shipping</span>
              </div>
            </div>
          </div>
          
          <div class="modal-reviews">
            <div class="rating-display">
              <span class="stars">★★★★★</span>
              <span class="review-count">({{ selectedProduct.reviews || '50' }} reviews)</span>
            </div>
            <div class="rating-text">Excellent based on customer reviews</div>
          </div>
          
          <!-- Pet ID Input Section -->
          <div class="cart-input-section" *ngIf="showPetIdInput">
            <h4>Select Pet</h4>
            <div class="input-group">
              <select class="form-control" [(ngModel)]="petId">
                <option value="" disabled selected>-- Select your pet --</option>
                <option *ngFor="let pet of userPets" [value]="pet.pet_id">
                  {{ pet.pet_name }} ({{ pet.species }} - {{ pet.breed }})
                </option>
              </select>
            </div>
            <div class="input-actions">
              <button class="btn-cancel" (click)="cancelCartProcess()">Cancel</button>
              <button class="btn-submit" (click)="submitPetId()">Next</button>
            </div>
          </div>
          
          <!-- Quantity Input Section -->
          <div class="cart-input-section" *ngIf="showQuantityInput">
            <h4>Select Quantity</h4>
            <div class="quantity-selector-large">
              <button class="quantity-btn minus" (click)="decrementQuantity()">-</button>
              <span class="quantity">{{ quantity }}</span>
              <button class="quantity-btn plus" (click)="incrementQuantity()">+</button>
            </div>
            <div class="input-actions">
              <button class="btn-cancel" (click)="cancelCartProcess()">Cancel</button>
              <button class="btn-submit" (click)="submitQuantity()">Add to Cart</button>
            </div>
          </div>
          
          <!-- Regular Modal Actions -->
          <div class="modal-actions" *ngIf="!showPetIdInput && !showQuantityInput">
            <div class="quantity-selector">
              <button class="quantity-btn minus" (click)="decrementQuantity()">-</button>
              <span class="quantity">{{ quantity }}</span>
              <button class="quantity-btn plus" (click)="incrementQuantity()">+</button>
            </div>
            <button class="add-to-cart-btn" (click)="addToCart(selectedProduct)">
              <i class="fas fa-shopping-cart"></i>
              Add to Cart
            </button>
          </div>
          
          <div class="product-features" *ngIf="!showPetIdInput && !showQuantityInput">
            <div class="feature">
              <i class="fas fa-shield-alt"></i>
              <span>1 Year Warranty</span>
            </div>
            <div class="feature">
              <i class="fas fa-truck"></i>
              <span>Free Delivery</span>
            </div>
            <div class="feature">
              <i class="fas fa-undo"></i>
              <span>30-Day Returns</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal-overlay" *ngIf="showAddProductModal" (click)="closeAddProductModal()">
    <div class="modal-content product-form-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeAddProductModal()">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="modal-header">
        <h2>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h2>
      </div>
      
      <form (ngSubmit)="saveProduct()" #productForm="ngForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="model">Product Model *</label>
            <input 
              type="text" 
              id="model" 
              [(ngModel)]="newProduct.model" 
              name="model" 
              required 
              placeholder="Enter product model name">
          </div>
          
          <div class="form-group">
            <label for="price">Price ($) *</label>
            <input 
              type="number" 
              id="price" 
              [(ngModel)]="newProduct.price" 
              name="price" 
              required 
              min="0" 
              step="0.01"
              placeholder="Enter price">
          </div>
          
          <div class="form-group">
            <label for="breed">Pet Type *</label>
            <select 
              id="breed" 
              [(ngModel)]="newProduct.breed" 
              name="breed" 
              required>
              <option value="" disabled selected>Select pet type</option>
              <option value="Dog">Dog</option>
              <option value="Cat">Cat</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="quantity">Quantity *</label>
            <input 
              type="number" 
              id="quantity" 
              [(ngModel)]="newProduct.quantity" 
              name="quantity" 
              required 
              min="0"
              placeholder="Enter stock quantity">
          </div>
          
          <div class="form-group">
            <label for="reviews">Rating (1-5)</label>
            <input 
              type="number" 
              id="reviews" 
              [(ngModel)]="newProduct.reviews" 
              name="reviews" 
              min="1" 
              max="5" 
              step="0.1"
              placeholder="Enter rating (1-5)">
          </div>
          
          <div class="form-group">
            <label for="deals">Deal Type</label>
            <select 
              id="deals" 
              [(ngModel)]="newProduct.deals" 
              name="deals">
              <option value="">No Deal</option>
              <option value="Hot Sale">Hot Sale</option>
              <option value="Bestseller">Bestseller</option>
            </select>
          </div>
          
          <div class="form-group full-width">
            <label for="product_info">Product Description *</label>
            <textarea 
              id="product_info" 
              [(ngModel)]="newProduct.product_info" 
              name="product_info" 
              required 
              rows="4"
              placeholder="Enter detailed product description"></textarea>
          </div>
          
          <!-- Update the file upload section in your add/edit product modal: -->
        <div class="form-group full-width">
          <label for="image">Product Image</label>
          <div class="file-upload-area" [class.dragover]="isDraggingOver">
            <input 
              type="file" 
              id="image" 
              #fileInput
              (change)="onFileSelected($event)" 
              accept="image/*"
              class="file-input">
            <div 
              class="upload-placeholder" 
              (click)="triggerFileInput()"
              (dragover)="onDragOver($event)" 
              (drop)="onDrop($event)" 
              (dragleave)="onDragLeave($event)">
              <i class="fas fa-cloud-upload-alt"></i>
              <p>Drag & drop an image here or click to browse</p>
              <p class="file-info" *ngIf="newProduct.image">
                Selected: {{ newProduct.image.name }}
              </p>
            </div>
          </div>
        </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeAddProductModal()">Cancel</button>
          <button type="submit" class="btn-submit" [disabled]="!productForm.valid || isCreatingProduct">
            <span *ngIf="isCreatingProduct">
              <i class="fas fa-spinner fa-spin"></i> Saving...
            </span>
            <span *ngIf="!isCreatingProduct">
              {{ editingProduct ? 'Update Product' : 'Add Product' }}
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeDeleteModal()">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="modal-body">
        <div class="warning-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Delete Product</h3>
        <p>Are you sure you want to delete this product? This action cannot be undone.</p>
        
        <div class="delete-preview" *ngIf="productToDelete">
          <img [src]="productToDelete.image" [alt]="productToDelete.model" *ngIf="productToDelete.image">
          <div class="delete-info">
            <h4>{{ productToDelete.model }}</h4>
            <p>{{ productToDelete.product_info }}</p>
            <div class="delete-details">
              <span><i class="fas fa-tag"></i> ${{ productToDelete.price }}</span>
              <span><i class="fas fa-paw"></i> {{ productToDelete.breed }}</span>
              <span><i class="fas fa-box"></i> Stock: {{ productToDelete.quantity }}</span>
            </div>
          </div>
        </div>
        
        <div class="delete-actions">
          <button type="button" class="btn-cancel" (click)="closeDeleteModal()">Cancel</button>
          <button type="button" class="btn-delete" (click)="confirmDelete()" [disabled]="isDeleting">
            <span *ngIf="isDeleting">
              <i class="fas fa-spinner fa-spin"></i> Deleting...
            </span>
            <span *ngIf="!isDeleting">
              Delete Product
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>