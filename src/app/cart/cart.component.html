<div class="container-fluid px-0" *ngIf="!loading; else loadingTpl">
  <!-- Main Content -->
  <section class="cart-main-section py-4">
    <div class="container">
      <!-- Cart Header -->
      <div class="cart-header">
        <h1 class="cart-title">Cart Items ({{ cartItems.length }})</h1>
        <p class="cart-subtitle">Products you're about to purchase</p>
      </div>

      <div class="row g-4 g-lg-5">
        <!-- Cart Items Column -->
        <div class="col-12 col-lg-8">
          <div class="cart-items-container">
            <!-- Empty Cart State -->
            <div *ngIf="cartItems.length === 0" class="empty-cart-state">
              <div class="empty-icon">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <h3 class="empty-title">Your Cart is Empty</h3>
              <p class="empty-text">Looks like you haven't added any items to your cart yet</p>
              <button class="shop-btn" routerLink="/shop">
                <i class="fas fa-shopping-bag"></i>
                Start Shopping
              </button>
            </div>

            <!-- Cart Items List -->
            <div *ngIf="cartItems.length > 0">
              <div class="cart-item" *ngFor="let item of cartItems; let i = index">
                <!-- Product Image - Small square -->
                <div class="product-image-container">
                  <img [src]="item.product_image" 
                       [alt]="item.product_name"
                       class="product-image"
                       onerror="this.src='assets/images/shop-main.jpg'" />
                </div>

                <!-- Product Details -->
                <div class="product-info">
                  <!-- Product Name Row -->
                  <div class="product-name-row">
                    <h3 class="product-name">{{ item.product_name }}</h3>
                    <button class="remove-btn" (click)="removeItem(item)" title="Remove item">
                      ×
                    </button>
                  </div>

                  <!-- Product Meta -->
                  <div class="product-meta">
                    <span class="meta-item">
                      <i class="fas fa-paw meta-icon"></i>
                      <span>{{ item.pet_name || 'Generic Pet' }}</span>
                    </span>
                    <span class="separator">•</span>
                    <span class="status-badge">
                      <i class="fas fa-check-circle"></i>
                      In Cart
                    </span>
                  </div>

                  <!-- Price and Quantity - Side by side -->
                  <div class="price-quantity-row">
                    <!-- Price Display -->
                    <div class="price-display">
                      <span class="price">₹{{ item.product_price }}</span>
                      <span class="price-label">each</span>
                      <span class="separator">×</span>
                      <span class="quantity-text">{{ item.quantity }}</span>
                      <span class="equal">=</span>
                      <span class="item-total">₹{{ item.product_price * item.quantity }}</span>
                    </div>

                    <!-- Quantity Controls -->
                    <div class="quantity-controls">
                      <button class="quantity-btn" 
                              (click)="updateQuantity(item, item.quantity - 1)" 
                              [disabled]="item.quantity <= 1">
                        <i class="fas fa-minus"></i>
                      </button>
                      <span class="quantity-display">{{ item.quantity }}</span>
                      <button class="quantity-btn" 
                              (click)="updateQuantity(item, item.quantity + 1)">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary Column -->
        <div class="col-12 col-lg-4" *ngIf="cartItems.length > 0">
          <div class="order-summary-card">
            <!-- Header -->
            <div class="summary-header">
              <h2 class="summary-title">Order Summary</h2>
              <i class="fas fa-receipt summary-icon"></i>
            </div>

            <!-- Summary Details -->
            <div class="summary-items">
              <div class="summary-row">
                <span class="summary-label">Items ({{ getTotalItems() }})</span>
                <span class="summary-value">₹{{ getSubtotal() }}</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Shipping</span>
                <span class="summary-value free-shipping">FREE</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Tax</span>
                <span class="summary-value">₹{{ getTax() }}</span>
              </div>
              
              <div class="summary-divider"></div>
              
              <div class="total-row">
                <span class="total-label">Total Amount</span>
                <span class="total-amount">₹{{ totalAmount }}</span>
              </div>
            </div>

            <!-- Trust Badges -->
            <div class="trust-badges">
              <div class="trust-badge">
                <i class="fas fa-shield-alt"></i>
                <small>Secure checkout</small>
              </div>
              <div class="trust-badge">
                <i class="fas fa-shipping-fast"></i>
                <small>Free shipping</small>
              </div>
              <div class="trust-badge">
                <i class="fas fa-undo"></i>
                <small>Free returns</small>
              </div>
            </div>

            <!-- Checkout Button -->
            <button class="checkout-btn" (click)="checkout()">
              <i class="fas fa-lock"></i>
              Proceed to Checkout
            </button>

            <!-- Security Note -->
            <div class="security-note">
              <i class="fas fa-lock"></i>
              Your payment information is secure and encrypted
            </div>

            <!-- Continue Shopping -->
            <div class="continue-shopping">
              <h4 class="continue-title">Need more items?</h4>
              <button class="continue-btn" routerLink="/shop">
                <i class="fas fa-arrow-left"></i>
                Continue Shopping
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<ng-template #loadingTpl>
  <div class="loading-container">
    <div class="text-center">
      <div class="spinner-border text-black" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3 text-muted">Loading your cart...</p>
    </div>
  </div>
</ng-template>