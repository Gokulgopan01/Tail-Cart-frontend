<div class="documents-locker">
  <!-- Header Section -->
  <header class="header-section luxury-header">
    <div class="container">
      <div class="documents-header-wrapper">
        <!-- Title + elegant subtitle -->
        <div class="documents-title-section">
          <h1 class="documents-main-title">Document Locker</h1>
          <p class="documents-subtitle">
            Your private vault for essential documents — secure, timeless, always within reach.
          </p>
        </div>

        <!-- Tabs with premium styling -->
        <div class="header-content">
          <div class="tabs-section">
            <div class="tabs-container luxury-tabs">
              <button 
                class="tab-btn" 
                [class.active]="activeTab === 'documents'"
                (click)="activeTab = 'documents'"
              >
                <span>Documents</span>
                <span class="tab-badge">{{ documents.length }}</span>
              </button>

              <button 
                class="tab-btn" 
                [class.active]="activeTab === 'alerts'"
                (click)="activeTab = 'alerts'"
              >
                <span>Alerts</span>
                <span class="tab-badge">{{ alerts.length }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Overdue Alert Banner – Luxury Style -->
  <div *ngIf="getOverdueAlerts().length > 0" class="overdue-banner luxury-overdue">
    <div class="container">
      <div class="banner-content">
        <div class="banner-icon-wrapper">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        
        <div class="banner-text">
          <strong>Overdue Attention Required</strong>
          <span class="banner-detail">
            {{ getOverdueAlerts().length }} document{{ getOverdueAlerts().length !== 1 ? 's' : '' }} 
            {{ getOverdueAlerts().length !== 1 ? 'have' : 'has' }} passed its reminder date — please review now.
          </span>
        </div>

        <button class="banner-action luxury-btn"
                (click)="activeTab = 'alerts'; scrollToAlerts()">
          View Alerts
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <main class="main-content luxury-main">
    <div class="container">

      <!-- Documents Tab -->
      <div *ngIf="activeTab === 'documents'" class="tab-content active luxury-tab-content">
        
        <!-- Controls -->
        <div class="controls-section luxury-controls">
          <div class="search-box luxury-search">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              [(ngModel)]="searchQuery" 
              (ngModelChange)="filterDocuments()"
              placeholder="Search your documents..." 
              class="search-input"
            >
          </div>
          
          <div class="filter-controls">
            <select class="filter-select luxury-select" [(ngModel)]="selectedType" (change)="filterDocuments()">
              <option value="">All Document Types</option>
              <option value="Pet Vaccination Record">Pet Vaccination Record</option>
              <option value="Pet Medical Record">Pet Medical Record</option>
              <option value="Pet Prescription">Pet Prescription</option>
              <option value="Veterinary Document">Veterinary Document</option>
              <option value="Other Pet Document">Other Pet Document</option>
            </select>
            
            <button class="upload-btn luxury-btn-primary" (click)="openUploadModal()">
              <i class="fas fa-plus"></i>
              Upload Document
            </button>
          </div>
        </div>

        <!-- View toggle + Grid/List -->
        <div class="documents-grid luxury-grid" [class.grid-view]="viewMode === 'grid'" [class.list-view]="viewMode === 'list'">
          
          <div class="view-toggle luxury-view-toggle">
            <button class="view-btn" [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'">
              <i class="fas fa-th-large"></i>
            </button>
            <button class="view-btn" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
              <i class="fas fa-list-ul"></i>
            </button>
          </div>

          <div *ngIf="filteredDocuments.length > 0; else emptyDocuments" class="cards-container luxury-cards">
            <div *ngFor="let doc of filteredDocuments" class="document-card luxury-card"
                [class.expired]="isDocumentExpired(doc)"
                [class.expiring]="isDocumentExpiring(doc)">
              
              <div class="card-header">
                <div class="doc-type-icon" [ngClass]="getDocTypeClass(doc.document_type)">
                  <i [class]="getDocTypeIcon(doc.document_type)"></i>
                </div>
                <div class="card-actions">
                  <button class="action-btn luxury-action" (click)="previewDocument(doc)" matTooltip="Preview">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="action-btn luxury-action" (click)="downloadDocument(doc)" matTooltip="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <div class="dropdown">
                    <button class="action-btn luxury-action" type="button" data-bs-toggle="dropdown">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu luxury-dropdown">
                      <li>
                        <button class="dropdown-item" (click)="setAlertForDocument(doc)">
                          <i class="fas fa-bell"></i> Set Reminder
                        </button>
                      </li>
                      <li>
                        <button class="dropdown-item text-danger" (click)="deleteDocument(doc.document_id)">
                          <i class="fas fa-trash-alt"></i> Delete
                        </button>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="card-body">
                <h3 class="doc-title">{{ doc.document_title }}</h3>
                <div class="doc-meta">
                  <div class="info-item">
                    <i class="far fa-file-alt"></i>
                    <span>{{ doc.file_name || 'document.pdf' }}</span>
                  </div>
                  <div class="info-item">
                    <i class="fas fa-weight-hanging"></i>
                    <span>{{ doc.file_size || '—' }}</span>
                  </div>
                </div>

                <div *ngIf="doc.expiry_date" class="expiry-status luxury-expiry">
                  <span class="expiry-label">Expires</span>
                  <span class="expiry-date" [ngClass]="{
                    'text-danger': isDocumentExpired(doc),
                    'text-warning': isDocumentExpiring(doc)
                  }">
                    {{ doc.expiry_date | date:'dd MMM yyyy' }}
                    <span *ngIf="isDocumentExpired(doc)" class="badge expired-badge">Expired</span>
                    <span *ngIf="isDocumentExpiring(doc)" class="badge expiring-badge">Soon</span>
                  </span>
                </div>
              </div>

              <div class="card-footer">
                <button class="view-btn luxury-view-btn" (click)="previewDocument(doc)">
                  View Document
                </button>
              </div>
            </div>
          </div>

          <ng-template #emptyDocuments>
            <div class="empty-state luxury-empty">
              <i class="far fa-folder-open empty-icon"></i>
              <h3>No documents yet</h3>
              <p>Start building your secure collection</p>
              <button class="btn-upload-primary luxury-btn-primary" (click)="openUploadModal()">
                <i class="fas fa-cloud-upload-alt"></i>
                Upload Your First Document
              </button>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Alerts Tab -->
      <div *ngIf="activeTab === 'alerts'" class="tab-content active luxury-tab-content">
        
        <div class="controls-section luxury-controls">
          <div class="search-box luxury-search">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              [(ngModel)]="alertSearchQuery" 
              (ngModelChange)="filterAlerts()"
              placeholder="Search reminders..." 
              class="search-input"
            >
          </div>
          
          <button class="create-alert-btn luxury-btn-primary" (click)="openCreateAlertModal()">
            <i class="fas fa-plus"></i>
            New Reminder
          </button>
        </div>

        <div *ngIf="filteredAlerts.length > 0; else emptyAlerts" class="alerts-list luxury-alerts">
          <div *ngFor="let alert of filteredAlerts" class="alert-card luxury-card">
            <div class="alert-header">
              <div class="alert-type">
                <i class="fas fa-bell"></i>
                <span>{{ alert.alert_type }}</span>
              </div>
              <label class="toggle-switch luxury-toggle">
                <input type="checkbox" [(ngModel)]="alert.is_active" (change)="toggleAlert(alert)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="alert-body">
              <h4 class="alert-title">{{ alert.title }}</h4>
              <div class="alert-meta">
                <div class="meta-item">
                  <i class="far fa-calendar-alt"></i>
                  <span>{{ alert.due_date | date:'dd MMM yyyy' }}</span>
                </div>
                <div class="meta-item">
                  <i class="far fa-clock"></i>
                  <span>{{ calculateDaysAgo(alert.due_date) }}</span>
                </div>
              </div>
              <p class="alert-message">{{ alert.custom_message || getDefaultAlertMessage(alert) }}</p>
            </div>

            <div class="alert-footer">
              <button class="btn-edit luxury-btn-outline" (click)="editAlert(alert)">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn-delete luxury-btn-outline danger" (click)="deleteAlert(alert)">
                <i class="fas fa-trash-alt"></i> Delete
              </button>
            </div>
          </div>
        </div>

        <ng-template #emptyAlerts>
          <div class="empty-state luxury-empty">
            <i class="far fa-bell-slash empty-icon"></i>
            <h3>No reminders set</h3>
            <p>Stay ahead with timely notifications</p>
            <button class="btn-upload-primary luxury-btn-primary" (click)="openCreateAlertModal()">
              <i class="fas fa-bell"></i>
              Create First Reminder
            </button>
          </div>
        </ng-template>
      </div>

    </div>
  </main>

  <!-- Upload Modal -->
  <div class="modal luxury-modal" 
      [class.show]="showUploadModal" 
      tabindex="-1"
      [attr.aria-hidden]="!showUploadModal"
      [style.display]="showUploadModal ? 'block' : 'none'">

  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content luxury-modal-content">
      
      <div class="modal-header luxury-header">
        <h2 class="modal-title">Upload Pet Documents</h2>
        <button type="button" class="btn-close luxury-close" 
                aria-label="Close" (click)="closeUploadModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body luxury-body">
        
        <!-- Drag & Drop Zone -->
        <div class="upload-zone luxury-upload-zone"
              (click)="fileInput.click()"
              [class.dragover]="isDragOver"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)">
          
          <input type="file" #fileInput (change)="onFileSelected($event)" class="d-none" multiple accept=".pdf,.jpg,.jpeg,.png">
          
          <div class="upload-placeholder" *ngIf="selectedFiles.length === 0">
            <i class="fas fa-cloud-upload-alt upload-icon"></i>
            <h4>Drag & drop your files here</h4>
            <p class="text-muted">or click to browse from your device</p>
            <p class="upload-hint">PDF, JPG, PNG • Max 10 MB per file</p>
          </div>

          <!-- Selected Files Preview -->
          <div *ngIf="selectedFiles.length > 0" class="selected-files-list">
            <div *ngFor="let file of selectedFiles; let i = index" class="file-preview-item">
              <div class="file-icon-wrapper">
                <i class="fas fa-file-pdf"></i>
              </div>
              <div class="file-details">
                <div class="file-name">{{ file.name }}</div>
                <div class="file-size">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</div>
              </div>
              <button class="btn-remove-file" (click)="removeFile(file)">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Form Fields -->
        <form [formGroup]="uploadForm" class="upload-form luxury-form">
          <div class="row g-4">
            <div class="col-12">
              <label class="form-label">Document Type <span class="text-danger">*</span></label>
              <select class="form-select luxury-select" formControlName="document_type">
                <option value="" disabled>Select document type</option>
                <option value="Pet Vaccination Record">Pet Vaccination Record</option>
                <option value="Pet Medical Record">Pet Medical Record</option>
                <option value="Pet Prescription">Pet Prescription</option>
                <option value="Veterinary Document">Veterinary Document</option>
                <option value="Other Pet Document">Other Pet Document</option>
              </select>
            </div>

            <div class="col-12">
              <label class="form-label">Document Title <span class="text-danger">*</span></label>
              <input type="text" class="form-control luxury-input"
                      formControlName="document_title"
                      placeholder="e.g. 2025 Rabies Vaccination Certificate">
            </div>

            <div class="col-12">
              <label class="form-label">Expiry Date (optional)</label>
              <input type="date" class="form-control luxury-input"
                      formControlName="expiry_date">
            </div>
          </div>

          <!-- Footer Buttons -->
          <div class="modal-actions">
            <button type="button" class="btn-cancel luxury-btn-outline" 
                    (click)="closeUploadModal()">
              Cancel
            </button>
            <button type="button" class="btn-upload luxury-btn-primary"
                    (click)="uploadDocuments()"
                    [disabled]="uploadForm.invalid || selectedFiles.length === 0 || isUploading">
              <span *ngIf="isUploading" class="spinner-border spinner-border-sm me-2" role="status"></span>
              {{ isUploading ? 'Uploading...' : 'Upload Documents' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  </div>

  <!-- Edit Alert Modal --------------------------->
  <div class="modal luxury-modal" 
      [class.show]="showEditAlertModal" 
      tabindex="-1"
      [attr.aria-hidden]="!showEditAlertModal"
      [style.display]="showEditAlertModal ? 'block' : 'none'">
    
    <div class="modal-dialog modal-dialog-centered modal-md">
      <div class="modal-content luxury-modal-content">
        
        <div class="modal-header luxury-header">
          <h2 class="modal-title">
            {{ editingAlert ? 'Edit Alert' : 'Create New Alert' }}
          </h2>
          <button type="button" class="btn-close luxury-close" 
                  aria-label="Close" (click)="closeEditAlertModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body luxury-body">
          <form [formGroup]="alertForm" class="alert-form luxury-form">
            <div class="row g-4">

              <div class="col-12">
                <label class="form-label">Pet <span class="text-danger">*</span></label>
                <select class="form-select luxury-select" formControlName="pet">
                  <option value="" disabled>Select a pet</option>
                  <option *ngFor="let pet of userPets" [value]="pet.id">
                    {{ pet.name }}
                  </option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Alert Type <span class="text-danger">*</span></label>
                <select class="form-select luxury-select" formControlName="alert_type">
                  <option value="" disabled>Select type</option>
                  <option value="Vaccination">Vaccination</option>
                  <option value="Medication">Medication</option>
                  <option value="Appointment">Appointment</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control luxury-input"
                      formControlName="title"
                      placeholder="e.g. Rabies Booster Shot">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Due Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control luxury-input"
                      formControlName="due_date">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Frequency</label>
                <select class="form-select luxury-select" formControlName="frequency">
                  <option value="One-time">One-time</option>
                  <option value="Daily">Daily</option>
                  <option value="Weekly">Weekly</option>
                  <option value="Monthly">Monthly</option>
                </select>
              </div>

            </div>

            <!-- Action Buttons -->
            <div class="modal-actions">
              <button type="button" class="btn-cancel luxury-btn-outline" 
                      (click)="closeEditAlertModal()">
                Cancel
              </button>
              <button type="button" class="btn-save luxury-btn-primary"
                      (click)="saveAlert()"
                      [disabled]="alertForm.invalid || isSavingAlert">
                <span *ngIf="isSavingAlert" class="spinner-border spinner-border-sm me-2" role="status"></span>
                {{ isSavingAlert ? 'Saving...' : (editingAlert ? 'Update Alert' : 'Create Alert') }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

<!-- Document View Modal ----------------------------------->
  <div class="modal luxury-modal" 
      [class.show]="showViewModal" 
      tabindex="-1"
      [attr.aria-hidden]="!showViewModal"
      [style.display]="showViewModal ? 'block' : 'none'">
    
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content luxury-modal-content">
        
        <div class="modal-header luxury-header">
          <h2 class="modal-title">
            {{ selectedDoc?.document_type || 'Document Preview' }}
          </h2>
          <button type="button" class="btn-close luxury-close" 
                  aria-label="Close" (click)="closeViewModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body luxury-body">
          <div *ngIf="selectedDoc" class="document-view luxury-document-view">

            <!-- Header with icon & title -->
            <div class="doc-header">
              <div class="doc-icon-wrapper" [ngClass]="getDocTypeClass(selectedDoc.document_type)">
                <i [class]="getDocTypeIcon(selectedDoc.document_type)"></i>
              </div>
              <div class="doc-info">
                <h3 class="doc-title">{{ selectedDoc.document_title }}</h3>
                <p class="doc-subtitle">{{ selectedDoc.document_type }}</p>
              </div>
            </div>

            <!-- Details Grid -->
            <div class="doc-details-grid">
              <div class="detail-card">
                <div class="detail-icon"><i class="far fa-file-alt"></i></div>
                <div class="detail-content">
                  <span class="detail-label">File Name</span>
                  <span class="detail-value">{{ selectedDoc.file_name || 'document.pdf' }}</span>
                </div>
              </div>

              <div class="detail-card">
                <div class="detail-icon"><i class="fas fa-weight-hanging"></i></div>
                <div class="detail-content">
                  <span class="detail-label">File Size</span>
                  <span class="detail-value">{{ selectedDoc.file_size || 'N/A' }}</span>
                </div>
              </div>

              <div class="detail-card" *ngIf="selectedDoc.expiry_date">
                <div class="detail-icon"><i class="far fa-calendar-times"></i></div>
                <div class="detail-content">
                  <span class="detail-label">Expiry Date</span>
                  <span class="detail-value" [ngClass]="{
                    'text-danger': isDocumentExpired(selectedDoc),
                    'text-warning': isDocumentExpiring(selectedDoc)
                  }">
                    {{ selectedDoc.expiry_date | date:'dd MMM yyyy' }}
                    <span *ngIf="isDocumentExpired(selectedDoc)" class="status-badge expired">Expired</span>
                    <span *ngIf="isDocumentExpiring(selectedDoc)" class="status-badge expiring">Expiring Soon</span>
                  </span>
                </div>
              </div>

              <div class="detail-card">
                <div class="detail-icon"><i class="far fa-clock"></i></div>
                <div class="detail-content">
                  <span class="detail-label">Uploaded On</span>
                  <span class="detail-value">{{ selectedDoc.upload_date | date:'dd MMM yyyy' }}</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="doc-actions luxury-actions">
              <button class="action-btn luxury-btn-outline" 
                      (click)="selectedDoc && downloadDocument(selectedDoc)">
                <i class="fas fa-download"></i>
                Download
              </button>

              <button class="action-btn luxury-btn-outline" 
                      (click)="selectedDoc && setAlertForDocument(selectedDoc)">
                <i class="fas fa-bell"></i>
                Set Reminder
              </button>

              <button class="action-btn luxury-btn-outline danger" 
                      (click)="selectedDoc && deleteDocument(selectedDoc.document_id)">
                <i class="fas fa-trash-alt"></i>
                Delete
              </button>
            </div>

          </div>

          <!-- Loading / no doc fallback (optional but nice) -->
          <div *ngIf="!selectedDoc" class="text-center py-5">
            <div class="spinner-border text-gold" role="status"></div>
            <p class="mt-3 text-muted">Loading document details...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop" [class.show]="showUploadModal || showEditAlertModal || showViewModal" 
       (click)="closeAllModals()"></div>
</div>