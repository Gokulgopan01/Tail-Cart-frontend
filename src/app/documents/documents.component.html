<div class="documents-locker">
  <!-- Header Section -->
  <header class="header-section">
    <div class="container">
      <div class="header-content">
        <div class="header-text">
          <h1 class="header-title">My Documents</h1>
          <p class="header-subtitle">Securely store and manage all your important documents</p>
        </div>
        
        <!-- Stats/Tabs -->
        <div class="tabs-section">
          <div class="tabs-container">
            <button class="tab-btn active" (click)="activeTab = 'documents'" [class.active]="activeTab === 'documents'">
              <span>Documents</span>
              <span class="tab-badge">{{ documents.length }}</span>
            </button>
            <button class="tab-btn" (click)="activeTab = 'alerts'" [class.active]="activeTab === 'alerts'">
              <span>Alerts</span>
              <span class="tab-badge">{{ alerts.length }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Overdue Alert Banner -->
  <div *ngIf="getOverdueAlerts().length > 0" class="overdue-banner">
    <div class="container">
      <div class="banner-content">
        <i class="fas fa-exclamation-circle"></i>
        <div class="banner-text">
          <strong>Overdue Alert:</strong> {{ getOverdueAlerts().length }} document{{ getOverdueAlerts().length > 1 ? 's' : '' }} need attention
        </div>
        <button class="banner-action" (click)="activeTab = 'alerts'">
          View
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <main class="main-content">
    <div class="container">
      <!-- Documents Tab -->
      <div *ngIf="activeTab === 'documents'" class="tab-content active">
        <!-- Search and Filters -->
        <div class="controls-section">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              [(ngModel)]="searchQuery" 
              (ngModelChange)="filterDocuments()"
              placeholder="Search documents..." 
              class="search-input"
            >
          </div>
          
          <div class="filter-controls">
            <select class="filter-select" [(ngModel)]="selectedType" (change)="filterDocuments()">
              <option value="">All Types</option>
              <option value="Pet Vaccination Record">Pet Vaccination Record</option>
              <option value="Pet Medical Record">Pet Medical Record</option>
              <option value="Pet Prescription">Pet Prescription</option>
              <option value="Veterinary Document">Veterinary Document</option>
              <option value="Other Pet Document">Other Pet Document</option>
            </select>
            
            <button class="upload-btn" (click)="openUploadModal()">
              <i class="fas fa-plus"></i>
              Upload Documents
            </button>
          </div>
        </div>

        <!-- Documents Grid -->
        <div class="documents-grid" [class.grid-view]="viewMode === 'grid'" [class.list-view]="viewMode === 'list'">
          <!-- View Toggle -->
          <div class="view-toggle">
            <button class="view-btn" [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'">
              <i class="fas fa-th"></i>
            </button>
            <button class="view-btn" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
              <i class="fas fa-list"></i>
            </button>
          </div>

          <!-- Document Cards -->
          <div *ngIf="filteredDocuments.length > 0; else emptyDocuments" class="cards-container">
            <div *ngFor="let doc of filteredDocuments" class="document-card" 
                 [class.expired]="isDocumentExpired(doc)"
                 [class.expiring]="isDocumentExpiring(doc)">
              <div class="card-header">
                <div class="doc-type-icon" [ngClass]="getDocTypeClass(doc.document_type)">
                  <i [class]="getDocTypeIcon(doc.document_type)"></i>
                </div>
                <div class="card-actions">
                  <button class="action-btn" (click)="previewDocument(doc)" matTooltip="View">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="action-btn" (click)="downloadDocument(doc)" matTooltip="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <div class="dropdown">
                    <button class="action-btn" type="button" data-bs-toggle="dropdown">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu">
                      <li>
                        <button class="dropdown-item" (click)="openEditModal(doc)">
                          <i class="fas fa-edit"></i> Edit
                        </button>
                      </li>
                      <li>
                        <button class="dropdown-item" (click)="setAlertForDocument(doc)">
                          <i class="fas fa-bell"></i> Set Alert
                        </button>
                      </li>
                      <li>
                        <button class="dropdown-item text-danger" (click)="deleteDocument(doc.document_id)">
                          <i class="fas fa-trash"></i> Delete
                        </button>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="card-body">
                <h3 class="doc-title">{{ doc.document_title }}</h3>
                <div class="doc-meta">
                  <div class="doc-info">
                    <div class="info-item">
                      <i class="far fa-file"></i>
                      <span>{{ doc.file_name || 'document.pdf' }}</span>
                    </div>
                    <div class="info-item">
                      <i class="fas fa-weight-hanging"></i>
                      <span>{{ doc.file_size || '240.0 KB' }}</span>
                    </div>
                  </div>
                </div>

                <!-- Expiry Status -->
                <div *ngIf="doc.expiry_date" class="expiry-status">
                  <span class="expiry-label">Expires</span>
                  <span class="expiry-date" [ngClass]="{
                    'text-danger': isDocumentExpired(doc),
                    'text-warning': isDocumentExpiring(doc)
                  }">
                    {{ doc.expiry_date | date:'dd MMM yyyy' }}
                    <span *ngIf="isDocumentExpired(doc)" class="badge expired-badge">Expired</span>
                    <span *ngIf="isDocumentExpiring(doc)" class="badge expiring-badge">Expiring Soon</span>
                  </span>
                </div>
              </div>

              <div class="card-footer">
                <button class="view-btn" (click)="previewDocument(doc)">
                  <span *ngIf="doc.document_type === 'PAN Card'">View</span>
                  <span *ngIf="doc.document_type !== 'PAN Card'">{{ getDocTypeIconText(doc.document_type) }}.pdf</span>
                </button>
              </div>
            </div>
          </div>

          <ng-template #emptyDocuments>
            <div class="empty-state">
              <div class="empty-icon">
                <i class="far fa-folder-open"></i>
              </div>
              <h3>No documents found</h3>
              <p class="text-muted">Upload your first document to get started</p>
              <button class="btn-upload-primary" (click)="openUploadModal()">
                <i class="fas fa-cloud-upload-alt"></i>
                Upload Document
              </button>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Alerts Tab -->
      <div *ngIf="activeTab === 'alerts'" class="tab-content active">
        <!-- Search Alerts -->
        <div class="controls-section">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              [(ngModel)]="alertSearchQuery" 
              (ngModelChange)="filterAlerts()"
              placeholder="Search alerts..." 
              class="search-input"
            >
          </div>
          
          <button class="create-alert-btn" (click)="openCreateAlertModal()">
            <i class="fas fa-plus"></i>
            Create Alert
          </button>
        </div>

        <!-- Alerts List -->
        <div *ngIf="filteredAlerts.length > 0; else emptyAlerts" class="alerts-list">
          <div *ngFor="let alert of filteredAlerts" class="alert-card">
            <div class="alert-header">
              <div class="alert-type">
                <i class="fas fa-bell"></i>
                <span>{{ alert.alert_type }}</span>
              </div>
              <div class="alert-toggle">
                <label class="toggle-switch">
                  <input type="checkbox" [(ngModel)]="alert.is_active" (change)="toggleAlert(alert)">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="alert-body">
              <h4 class="alert-title">{{ alert.title }}</h4>
              <div class="alert-meta">
                <div class="meta-item">
                  <i class="far fa-calendar"></i>
                  <span>{{ alert.due_date | date:'dd MMM yyyy' }}</span>
                </div>
                <div class="meta-item">
                  <i class="far fa-clock"></i>
                  <span>{{ calculateDaysAgo(alert.due_date) }}</span>
                </div>
              </div>
              <p class="alert-message">{{ alert.custom_message || getDefaultAlertMessage(alert) }}</p>
            </div>

            <div class="alert-footer">
              <button class="btn-edit" (click)="editAlert(alert)">
                <i class="fas fa-edit"></i>
                Edit Alert
              </button>
            </div>
          </div>
        </div>

        <ng-template #emptyAlerts>
          <div class="empty-state">
            <div class="empty-icon">
              <i class="far fa-bell-slash"></i>
            </div>
            <h3>No alerts yet</h3>
            <p class="text-muted">Create your first alert to get reminders</p>
            <button class="btn-upload-primary" (click)="openCreateAlertModal()">
              <i class="fas fa-bell"></i>
              Create Alert
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </main>

  <!-- Upload Modal -->
  <div class="modal" [class.show]="showUploadModal" tabindex="-1" 
       [attr.aria-hidden]="!showUploadModal" [style.display]="showUploadModal ? 'block' : 'none'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Upload Documents</h2>
          <button type="button" class="btn-close" (click)="closeUploadModal()"></button>
        </div>
        <div class="modal-body">
          <div class="upload-zone" (click)="fileInput.click()" [class.dragover]="isDragOver"
               (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
            <input type="file" #fileInput (change)="onFileSelected($event)" class="d-none" multiple>
            <i class="fas fa-cloud-upload-alt"></i>
            <h4>Drag & drop files here</h4>
            <p class="text-muted">or click to browse</p>
            <p class="upload-hint">Supports PDF, JPG, PNG up to 10MB</p>
            
            <div *ngIf="selectedFiles.length > 0" class="selected-files">
              <div *ngFor="let file of selectedFiles" class="file-item">
                <i class="fas fa-file-pdf"></i>
                <div class="file-info">
                  <strong>{{ file.name }}</strong>
                  <small>{{ (file.size / 1024).toFixed(1) }} KB</small>
                </div>
                <button class="btn-remove" (click)="removeFile(file)">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>

          <form [formGroup]="uploadForm" class="upload-form">
            <div class="form-group">
              <label>Document Type</label>
              <select class="form-select" formControlName="document_type">
                <option value="">Select Type</option>
                <option value="Pet Vaccination Record">Pet Vaccination Record</option>
                <option value="Pet Medical Record">Pet Medical Record</option>
                <option value="Pet Prescription">Pet Prescription</option>
                <option value="Veterinary Document">Veterinary Document</option>
                <option value="Other Pet Document">Other Pet Document</option>
              </select>
            </div>

            <div class="form-group">
              <label>Document Title</label>
              <input
                type="text"
                class="form-control"
                formControlName="document_title"
                placeholder="e.g., Rabies Vaccination Certificate"
              />
            </div>
            <div class="form-group">
              <label>Expiry Date (Optional)</label>
              <input type="date" class="form-control" formControlName="expiry_date">
            </div>

            <div class="modal-footer">
              <button type="button" class="btn-cancel" (click)="closeUploadModal()">Cancel</button>
              <button type="button" class="btn-upload" (click)="uploadDocuments()" 
                      [disabled]="uploadForm.invalid || selectedFiles.length === 0 || isUploading">
                <span *ngIf="isUploading" class="spinner"></span>
                {{ isUploading ? 'Uploading...' : 'Upload' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Alert Modal -->
  <div class="modal" [class.show]="showEditAlertModal" tabindex="-1" 
       [attr.aria-hidden]="!showEditAlertModal" [style.display]="showEditAlertModal ? 'block' : 'none'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Edit Alert</h2>
          <button type="button" class="btn-close" (click)="closeEditAlertModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="alertForm" class="alert-form">
            <div class="form-group">
              <label>Alert Type</label>
              <select class="form-select" formControlName="alert_type">
                <option value="Expiry Reminder">Expiry Reminder</option>
                <option value="Review Reminder">Review Reminder</option>
                <option value="Renewal Reminder">Renewal Reminder</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label>Alert Date</label>
              <input type="date" class="form-control" formControlName="due_date">
            </div>

            <div class="form-group">
              <label>Days Before Expiry</label>
              <select class="form-select" formControlName="days_before">
                <option value="7">7 days</option>
                <option value="15">15 days</option>
                <option value="30">30 days</option>
                <option value="60">60 days</option>
              </select>
            </div>

            <div class="form-group">
              <label>Custom Message (Optional)</label>
              <textarea class="form-control" formControlName="custom_message" 
                        placeholder="Add a custom reminder message..." rows="3"></textarea>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn-cancel" (click)="closeEditAlertModal()">Cancel</button>
              <button type="button" class="btn-save" (click)="saveAlert()" 
                      [disabled]="alertForm.invalid || isSavingAlert">
                <span *ngIf="isSavingAlert" class="spinner"></span>
                {{ isSavingAlert ? 'Saving...' : 'Update Alert' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- View Document Modal -->
<div class="modal" [class.show]="showViewModal" tabindex="-1" 
     [attr.aria-hidden]="!showViewModal" [style.display]="showViewModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">{{ selectedDoc?.document_type }}</h2>
        <button type="button" class="btn-close" (click)="closeViewModal()"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="selectedDoc" class="document-view">
          <div class="doc-header">
            <div class="doc-icon" [ngClass]="getDocTypeClass(selectedDoc.document_type)">
              <i [class]="getDocTypeIcon(selectedDoc.document_type)"></i>
            </div>
            <h3>{{ selectedDoc.document_title }}</h3>
          </div>

          <div class="doc-details">
            <div class="detail-item">
              <span class="label">File Name:</span>
              <span class="value">{{ selectedDoc.file_name || 'document.pdf' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">File Size:</span>
              <span class="value">{{ selectedDoc.file_size || 'N/A' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDoc.expiry_date">
              <span class="label">Expiry Date:</span>
              <span class="value" [ngClass]="{
                'text-danger': isDocumentExpired(selectedDoc),
                'text-warning': isDocumentExpiring(selectedDoc)
              }">
                {{ selectedDoc.expiry_date | date:'dd MMM yyyy' }}
                <span *ngIf="isDocumentExpired(selectedDoc)" class="badge expired-badge">Expired</span>
                <span *ngIf="isDocumentExpiring(selectedDoc)" class="badge expiring-badge">Expiring Soon</span>
              </span>
            </div>
            <div class="detail-item">
              <span class="label">Uploaded:</span>
              <span class="value">{{ selectedDoc.upload_date | date:'dd MMM yyyy' }}</span>
            </div>
          </div>

          <div class="doc-actions">
            <button class="btn-download" (click)="selectedDoc && downloadDocument(selectedDoc)">
              <i class="fas fa-download"></i>
              Download
            </button>
            <button class="btn-set-alert" (click)="selectedDoc && setAlertForDocument(selectedDoc)">
              <i class="fas fa-bell"></i>
              Set Alert
            </button>
            <button class="btn-delete" (click)="selectedDoc && deleteDocument(selectedDoc.document_id)">
              <i class="fas fa-trash"></i>
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop" [class.show]="showUploadModal || showEditAlertModal || showViewModal" 
       (click)="closeAllModals()"></div>
</div>