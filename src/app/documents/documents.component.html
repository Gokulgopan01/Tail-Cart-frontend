<div class="documents-locker">
  <!-- Header Section -->
  <header class="header-section">
    <div class="container">
      <div class="documents-header-wrapper">
        <div class="documents-title-section">
          <h1 class="documents-main-title">Personal Vault</h1>
          <p class="documents-subtitle">Secure storage for your pet's vital documents and reminders.</p>
        </div>

        <div class="tabs-container">
          <button class="tab-btn" [class.active]="activeTab === 'documents'" (click)="activeTab = 'documents'">
            <i class="fas fa-folder"></i>
            <span>Documents</span>
            <span class="tab-badge">{{ documents.length }}</span>
          </button>

          <button class="tab-btn" [class.active]="activeTab === 'alerts'" (click)="activeTab = 'alerts'">
            <i class="fas fa-bell"></i>
            <span>Alerts</span>
            <span class="tab-badge">{{ alerts.length }}</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Smart High-Priority Alert Banner -->
  <div *ngIf="getOverdueAlerts().length > 0 || getUpcomingAlerts().length > 0" class="priority-banner">
    <div class="container">
      <div class="banner-flex">
        <div class="banner-info">
          <div class="banner-icon pulse">
            <i class="fas fa-exclamation-circle"></i>
          </div>
          <div class="banner-text">
            <h4 *ngIf="getOverdueAlerts().length > 0">Overdue Reminders!</h4>
            <h4 *ngIf="getOverdueAlerts().length === 0 && getUpcomingAlerts().length > 0">Upcoming Reminders</h4>
            <p>
              <span *ngIf="getOverdueAlerts().length > 0">{{ getOverdueAlerts().length }} items need immediate
                attention.</span>
              <span *ngIf="getUpcomingAlerts().length > 0"> {{ getUpcomingAlerts().length }} reminders due today or
                tomorrow.</span>
            </p>
          </div>
        </div>
        <button class="banner-btn" (click)="activeTab = 'alerts'">
          Review Now <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <main class="main-content container">
    <!-- Documents Tab -->
    <section *ngIf="activeTab === 'documents'" class="tab-pane fade-in">
      <div class="toolbar-section">
        <div class="toolbar-left">
          <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="filterDocuments()"
              placeholder="Search documents..." class="modern-input">
          </div>
          <select class="modern-select" [(ngModel)]="selectedType" (change)="filterDocuments()">
            <option value="">All Types</option>
            <option value="Pet Vaccination Record">Vaccinations</option>
            <option value="Pet Medical Record">Medical</option>
            <option value="Pet Prescription">Prescriptions</option>
            <option value="Veterinary Document">Veterinary</option>
            <option value="Other Pet Document">Other</option>
          </select>
        </div>

        <div class="toolbar-right">
          <div class="view-toggle">
            <button class="toggle-btn" [class.active]="docsViewMode === 'grid'" (click)="docsViewMode = 'grid'">
              <i class="fas fa-th"></i>
            </button>
            <button class="toggle-btn" [class.active]="docsViewMode === 'list'" (click)="docsViewMode = 'list'">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <button class="btn-primary" (click)="openUploadModal()">
            <i class="fas fa-cloud-upload-alt"></i> Upload
          </button>
        </div>
      </div>

      <div class="docs-display" [class.grid-mode]="docsViewMode === 'grid'" [class.list-mode]="docsViewMode === 'list'">
        <ng-container *ngIf="filteredDocuments.length > 0; else noDocs">
          <div *ngFor="let doc of filteredDocuments" class="doc-card premium-card"
            [class.expired]="isDocumentExpired(doc)">
            <div class="card-bg-pattern"></div>
            <div class="card-gradient" [ngClass]="getDocTypeClass(doc.document_type)"></div>

            <div class="card-content">
              <div class="card-header">
                <div class="doc-icon"><i [class]="getDocTypeIcon(doc.document_type)"></i></div>
                <div class="card-actions">
                  <button class="icon-btn" (click)="previewDocument(doc)" title="View"><i
                      class="fas fa-eye"></i></button>
                  <button class="icon-btn" (click)="downloadDocument(doc)" title="Download"><i
                      class="fas fa-download"></i></button>
                  <button class="icon-btn" (click)="setAlertForDocument(doc)" title="Set Reminder"><i
                      class="fas fa-bell"></i></button>
                  <button class="icon-btn danger" (click)="deleteDocument(doc.document_id)" title="Delete"><i
                      class="fas fa-trash-alt"></i></button>
                </div>
              </div>

              <div class="card-body">
                <h3 class="doc-title">{{ doc.document_title }}</h3>
                <div class="doc-meta">
                  <span><i class="far fa-calendar-alt"></i> {{ doc.upload_date | date:'dd MMM yyyy' }}</span>
                  <span><i class="fas fa-file-invoice"></i> {{ doc.file_name || 'document.pdf' }}</span>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </section>

    <!-- Alerts Tab -->
    <section *ngIf="activeTab === 'alerts'" class="tab-pane fade-in">
      <div class="toolbar-section">
        <div class="toolbar-left">
          <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" [(ngModel)]="alertSearchQuery" (ngModelChange)="filterAlerts()"
              placeholder="Search alerts..." class="modern-input">
          </div>
        </div>

        <div class="toolbar-right">
          <div class="view-toggle">
            <button class="toggle-btn" [class.active]="alertViewMode === 'grid'" (click)="alertViewMode = 'grid'">
              <i class="fas fa-th"></i>
            </button>
            <button class="toggle-btn" [class.active]="alertViewMode === 'list'" (click)="alertViewMode = 'list'">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <button class="btn-primary" (click)="openCreateAlertModal()">
            <i class="fas fa-plus"></i> New Alert
          </button>
        </div>
      </div>

      <div class="alerts-display" [class.grid-mode]="alertViewMode === 'grid'"
        [class.list-mode]="alertViewMode === 'list'">
        <ng-container *ngIf="filteredAlerts.length > 0; else noAlerts">
          <div *ngFor="let alert of filteredAlerts" class="alert-card premium-card" [class.inactive]="!alert.is_active">
            <div class="card-bg-pattern"></div>
            <div class="card-gradient alert-type-{{alert.alert_type.toLowerCase()}}"></div>

            <div class="card-content">
              <div class="card-header">
                <div class="alert-icon"><i class="fas fa-clock"></i></div>
                <div class="alert-status">
                  <span class="status-label">{{ alert.is_active ? 'Active' : 'Inactive' }}</span>
                  <label class="switch">
                    <input type="checkbox" [(ngModel)]="alert.is_active" (change)="toggleAlert(alert)">
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>

              <div class="card-body">
                <h3 class="alert-title">{{ alert.title }}</h3>
                <div class="alert-meta">
                  <span class="type-tag">{{ alert.alert_type }}</span>
                  <span class="due-tag"><i class="far fa-calendar-check"></i> Due: {{ alert.due_date | date:'dd MMM
                    yyyy' }}</span>
                </div>
              </div>

              <div class="card-footer">
                <button class="lite-btn edit-btn" (click)="editAlert(alert)"><i class="fas fa-edit"></i> Edit</button>
                <button class="lite-btn danger" (click)="deleteAlert(alert)"><i class="fas fa-trash"></i>
                  Delete</button>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </section>

    <!-- Empty States -->
    <ng-template #noDocs>
      <div class="empty-state">
        <i class="far fa-folder-open"></i>
        <h3>No documents found</h3>
        <p>Your search didn't return any matches. Try adjusting your filters.</p>
        <button class="btn-clear" (click)="searchQuery = ''; selectedType = ''; filterDocuments()">Clear All</button>
      </div>
    </ng-template>

    <ng-template #noAlerts>
      <div class="empty-state">
        <i class="far fa-bell-slash"></i>
        <h3>No alerts found</h3>
        <p>You haven't set any reminders yet. Tap "New Alert" to stay ahead.</p>
      </div>
    </ng-template>
  </main>

  <!-- Upload Modal -->
  <div class="modal-root" *ngIf="showUploadModal" (click)="closeUploadModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Upload Document</h3>
        <button class="close-btn" (click)="closeUploadModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="upload-dropzone" (click)="fileInput.click()" [class.dragover]="isDragOver"
          (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>{{ selectedFiles.length > 0 ? selectedFiles.length + ' files selected' : 'Tap or drag files to upload' }}
          </p>
          <input type="file" #fileInput (change)="onFileSelected($event)" class="d-none" multiple>
        </div>

        <form [formGroup]="uploadForm" class="modern-form">
          <div class="form-group">
            <label>Title</label>
            <input type="text" formControlName="document_title" class="modern-input" placeholder="e.g. Health Record">
          </div>
          <div class="form-group">
            <label>Type</label>
            <select formControlName="document_type" class="modern-select">
              <option value="Pet Vaccination Record">Vaccination</option>
              <option value="Pet Medical Record">Medical Record</option>
              <option value="Pet Prescription">Prescription</option>
              <option value="Veterinary Document">Veterinary</option>
              <option value="Other Pet Document">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Expiry Date</label>
            <input type="date" formControlName="expiry_date" class="modern-input">
          </div>
          <div class="form-actions">
            <button type="button" class="btn-lite" (click)="closeUploadModal()">Cancel</button>
            <button type="button" class="btn-primary" (click)="uploadDocuments()"
              [disabled]="uploadForm.invalid || isUploading">
              {{ isUploading ? 'Uploading...' : 'Save Document' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Alert Modal -->
  <div class="modal-root" *ngIf="showEditAlertModal" (click)="closeEditAlertModal()">
    <div class="modal-card small-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingAlert ? 'Edit Alert' : 'Create Alert' }}</h3>
        <button class="close-btn" (click)="closeEditAlertModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="alertForm" class="modern-form">
          <div class="form-group">
            <label>Pet</label>
            <select formControlName="pet" class="modern-select">
              <option *ngFor="let pet of userPets" [value]="pet.id">{{ pet.name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Alert Type</label>
            <select formControlName="alert_type" class="modern-select">
              <option value="Vaccination">Vaccination</option>
              <option value="Medication">Medication</option>
              <option value="Appointment">Appointment</option>
            </select>
          </div>
          <div class="form-group">
            <label>Title</label>
            <input type="text" formControlName="title" class="modern-input" placeholder="e.g. Rabies Booster">
          </div>
          <div class="form-group">
            <label>Due Date</label>
            <input type="date" formControlName="due_date" class="modern-input">
          </div>
          <div class="form-group">
            <label>Frequency</label>
            <select formControlName="frequency" class="modern-select">
              <option value="One-time">One-time</option>
              <option value="Daily">Daily</option>
              <option value="Weekly">Weekly</option>
              <option value="Monthly">Monthly</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-lite" (click)="closeEditAlertModal()">Cancel</button>
            <button type="button" class="btn-primary" (click)="saveAlert()"
              [disabled]="alertForm.invalid || isSavingAlert">
              {{ isSavingAlert ? 'Saving...' : 'Save Alert' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Document View Modal (Existing logic preserved) -->
  <div class="modal-root" *ngIf="showViewModal" (click)="closeViewModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <!-- (Simplified existing view content for better luxury feel) -->
      <div class="modal-header">
        <h3>{{ selectedDoc?.document_title }}</h3>
        <button class="close-btn" (click)="closeViewModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body doc-preview-body">
        <div class="doc-viewer">
          <i class="fas fa-file-pdf large-icon"></i>
          <p>{{ selectedDoc?.file_name }}</p>
        </div>
        <div class="view-actions">
          <button class="btn-primary" (click)="downloadDocument(selectedDoc)"><i class="fas fa-download"></i>
            Download</button>
          <button class="btn-danger" (click)="deleteDocument(selectedDoc?.document_id)"><i class="fas fa-trash"></i>
            Delete Forever</button>
        </div>
      </div>
    </div>
  </div>
</div>