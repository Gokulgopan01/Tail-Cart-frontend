<div class="documents-locker">
  <!-- Header Section -->
  <header class="header-section">
    <div class="container">
      <div class="documents-header-wrapper">
        <!-- Title + elegant subtitle -->
        <div class="documents-title-section">
          <h1 class="documents-main-title">Document Locker</h1>
          <p class="documents-subtitle">
            Your private vault for essential documents — secure, timeless, always within reach.
          </p>
        </div>

        <!-- Tabs with premium styling -->
        <div class="header-content">
          <div class="tabs-section">
            <div class="tabs-container">
              <button class="tab-btn" [class.active]="activeTab === 'documents'" (click)="activeTab = 'documents'">
                <span>Documents</span>
                <span class="tab-badge">{{ documents.length }}</span>
              </button>

              <button class="tab-btn" [class.active]="activeTab === 'alerts'" (click)="activeTab = 'alerts'">
                <span>Alerts</span>
                <span class="tab-badge">{{ alerts.length }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Overdue Alert Banner – Luxury Style -->
  <div *ngIf="getOverdueAlerts().length > 0" class="overdue-banner">
    <div class="container">
      <div class="banner-content">
        <div class="banner-icon-wrapper">
          <i class="fas fa-exclamation-triangle"></i>
        </div>

        <div class="banner-text">
          <strong>Overdue Attention Required</strong>
          <span class="banner-detail">
            {{ getOverdueAlerts().length }} document{{ getOverdueAlerts().length !== 1 ? 's' : '' }}
            {{ getOverdueAlerts().length !== 1 ? 'have' : 'has' }} passed its reminder date — please review now.
          </span>
        </div>

        <button class="banner-action" (click)="activeTab = 'alerts'; scrollToAlerts()">
          View Alerts
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <main class="main-content">
    <div class="container">

      <!-- Documents Tab -->
      <div *ngIf="activeTab === 'documents'" class="tab-content active">

        <!-- Controls -->
        <div class="controls-section">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="filterDocuments()"
              placeholder="Search your documents..." class="search-input">
          </div>

          <div class="filter-controls">
            <select class="filter-select" [(ngModel)]="selectedType" (change)="filterDocuments()">
              <option value="">All Document Types</option>
              <option value="Pet Vaccination Record">Pet Vaccination Record</option>
              <option value="Pet Medical Record">Pet Medical Record</option>
              <option value="Pet Prescription">Pet Prescription</option>
              <option value="Veterinary Document">Veterinary Document</option>
              <option value="Other Pet Document">Other Pet Document</option>
            </select>

            <button class="upload-btn" (click)="openUploadModal()">
              <i class="fas fa-plus"></i>
              Upload Document
            </button>
          </div>

          <!-- View toggle + Grid/List -->
          <div class="view-toggle">
            <button class="view-btn" [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'">
              <i class="fas fa-th-large"></i>
            </button>
            <button class="view-btn" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
              <i class="fas fa-list-ul"></i>
            </button>
          </div>
        </div>

        <div class="documents-grid" [class.grid-view]="viewMode === 'grid'" [class.list-view]="viewMode === 'list'">

          <div *ngIf="filteredDocuments.length > 0; else emptyDocuments" class="cards-container">
            <div *ngFor="let doc of filteredDocuments" class="document-card" [class.expired]="isDocumentExpired(doc)"
              [class.expiring]="isDocumentExpiring(doc)">

              <div class="card-header">
                <div class="doc-type-icon" [ngClass]="getDocTypeClass(doc.document_type)">
                  <i [class]="getDocTypeIcon(doc.document_type)"></i>
                </div>
                <div class="card-actions">
                  <button class="action-btn" (click)="previewDocument(doc)" matTooltip="Preview">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="action-btn" (click)="downloadDocument(doc)" matTooltip="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <div class="dropdown">
                    <button class="action-btn" type="button" data-bs-toggle="dropdown">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu">
                      <li>
                        <button class="dropdown-item" (click)="setAlertForDocument(doc)">
                          <i class="fas fa-bell"></i> Set Reminder
                        </button>
                      </li>
                      <li>
                        <button class="dropdown-item text-danger" (click)="deleteDocument(doc.document_id)">
                          <i class="fas fa-trash-alt"></i> Delete
                        </button>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="card-body">
                <h3 class="doc-title">{{ doc.document_title }}</h3>
                <div class="doc-meta">
                  <div class="info-item">
                    <i class="far fa-file-alt"></i>
                    <span>{{ doc.file_name || 'document.pdf' }}</span>
                  </div>
                  <div class="info-item">
                    <i class="fas fa-weight-hanging"></i>
                    <span>{{ doc.file_size || '—' }}</span>
                  </div>
                </div>

                <div *ngIf="doc.expiry_date" class="expiry-status">
                  <span class="expiry-label">Expires</span>
                  <span class="expiry-date" [ngClass]="{
                    'text-danger': isDocumentExpired(doc),
                    'text-warning': isDocumentExpiring(doc)
                  }">
                    {{ doc.expiry_date | date:'dd MMM yyyy' }}
                    <span *ngIf="isDocumentExpired(doc)" class="badge expired-badge">Expired</span>
                    <span *ngIf="isDocumentExpiring(doc)" class="badge expiring-badge">Soon</span>
                  </span>
                </div>
              </div>

              <div class="card-footer">
                <button class="view-btn" (click)="previewDocument(doc)">
                  View Document
                </button>
              </div>
            </div>
          </div>

          <ng-template #emptyDocuments>
            <div class="empty-state">
              <div class="empty-icon">
                <i class="far fa-folder-open"></i>
              </div>
              <h3>No documents yet</h3>
              <p>Start building your secure collection</p>
              <button class="btn-upload-primary" (click)="openUploadModal()">
                <i class="fas fa-cloud-upload-alt"></i>
                Upload Your First Document
              </button>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Alerts Tab -->
      <div *ngIf="activeTab === 'alerts'" class="tab-content active">

        <div class="controls-section">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" [(ngModel)]="alertSearchQuery" (ngModelChange)="filterAlerts()"
              placeholder="Search reminders..." class="search-input">
          </div>

          <button class="create-alert-btn" (click)="openCreateAlertModal()">
            <i class="fas fa-plus"></i>
            New Reminder
          </button>
        </div>

        <div *ngIf="filteredAlerts.length > 0; else emptyAlerts" class="alerts-list">
          <div *ngFor="let alert of filteredAlerts" class="alert-card" [class.active]="alert.is_active"
            [class.inactive]="!alert.is_active">
            <div class="alert-header">
              <div class="alert-type">
                <i class="fas fa-bell"></i>
                <span>{{ alert.alert_type }}</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [(ngModel)]="alert.is_active" (change)="toggleAlert(alert)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="alert-body">
              <h4 class="alert-title">{{ alert.title }}</h4>
              <div class="alert-meta">
                <div class="meta-item">
                  <i class="far fa-calendar-alt"></i>
                  <span>{{ alert.due_date | date:'dd MMM yyyy' }}</span>
                </div>
                <div class="meta-item">
                  <i class="far fa-clock"></i>
                  <span>{{ calculateDaysAgo(alert.due_date) }}</span>
                </div>
              </div>
              <p class="alert-message">{{ alert.custom_message || getDefaultAlertMessage(alert) }}</p>
            </div>

            <div class="alert-footer">
              <button class="btn-edit" (click)="editAlert(alert)">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn-delete" (click)="deleteAlert(alert)">
                <i class="fas fa-trash-alt"></i> Delete
              </button>
            </div>
          </div>
        </div>

        <ng-template #emptyAlerts>
          <div class="empty-state">
            <div class="empty-icon">
              <i class="far fa-bell-slash"></i>
            </div>
            <h3>No reminders set</h3>
            <p>Stay ahead with timely notifications</p>
            <button class="btn-upload-primary" (click)="openCreateAlertModal()">
              <i class="fas fa-bell"></i>
              Create First Reminder
            </button>
          </div>
        </ng-template>
      </div>

    </div>
  </main>

  <!-- Upload Modal -->
  <div class="modal" [class.show]="showUploadModal" tabindex="-1" [attr.aria-hidden]="!showUploadModal">

    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h2 class="modal-title">Upload Documents</h2>
          <button type="button" class="btn-close" aria-label="Close" (click)="closeUploadModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">

          <!-- Drag & Drop Zone -->
          <div class="upload-zone" (click)="fileInput.click()" [class.dragover]="isDragOver"
            (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">

            <input type="file" #fileInput (change)="onFileSelected($event)" class="d-none" multiple
              accept=".pdf,.jpg,.jpeg,.png">

            <div class="upload-placeholder" *ngIf="selectedFiles.length === 0">
              <i class="fas fa-cloud-upload-alt upload-icon"></i>
              <h4>Drag & drop your files here</h4>
              <p class="upload-hint">PDF, JPG, PNG • Max 10 MB per file</p>
            </div>

            <!-- Selected Files Preview -->
            <div *ngIf="selectedFiles.length > 0" class="selected-files-list">
              <div *ngFor="let file of selectedFiles; let i = index" class="file-preview-item">
                <div class="file-icon-wrapper">
                  <i class="fas fa-file-pdf"></i>
                </div>
                <div class="file-details">
                  <div class="file-name">{{ file.name }}</div>
                  <div class="file-size">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</div>
                </div>
                <button class="btn-remove-file" (click)="removeFile(file)">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Form Fields -->
          <form [formGroup]="uploadForm" class="upload-form">
            <div class="row g-4">
              <div class="col-12">
                <label class="form-label">Document Type <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="document_type">
                  <option value="" disabled>Select document type</option>
                  <option value="Pet Vaccination Record">Pet Vaccination Record</option>
                  <option value="Pet Medical Record">Pet Medical Record</option>
                  <option value="Pet Prescription">Pet Prescription</option>
                  <option value="Veterinary Document">Veterinary Document</option>
                  <option value="Other Pet Document">Other Pet Document</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Document Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="document_title"
                  placeholder="e.g. 2025 Rabies Vaccination Certificate">
              </div>

              <div class="col-12">
                <label class="form-label">Expiry Date (optional)</label>
                <input type="date" class="form-control" formControlName="expiry_date">
              </div>
            </div>

            <!-- Footer Buttons -->
            <div class="modal-actions">
              <button type="button" class="btn-cancel" (click)="closeUploadModal()">
                Cancel
              </button>
              <button type="button" class="btn-upload" (click)="uploadDocuments()"
                [disabled]="uploadForm.invalid || selectedFiles.length === 0 || isUploading">
                <span *ngIf="isUploading" class="spinner-border spinner-border-sm me-2" role="status"></span>
                {{ isUploading ? 'Uploading...' : 'Upload Documents' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Alert Modal -->
  <div class="modal" [class.show]="showEditAlertModal" tabindex="-1" [attr.aria-hidden]="!showEditAlertModal">

    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h2 class="modal-title">
            {{ editingAlert ? 'Edit Alert' : 'Create New Alert' }}
          </h2>
          <button type="button" class="btn-close" aria-label="Close" (click)="closeEditAlertModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <form [formGroup]="alertForm" class="alert-form">
            <div class="row g-4">

              <div class="col-12">
                <label class="form-label">Pet <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="pet">
                  <option value="" disabled>Select a pet</option>
                  <option *ngFor="let pet of userPets" [value]="pet.id">
                    {{ pet.name }}
                  </option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Alert Type <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="alert_type">
                  <option value="" disabled>Select type</option>
                  <option value="Vaccination">Vaccination</option>
                  <option value="Medication">Medication</option>
                  <option value="Appointment">Appointment</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="title" placeholder="e.g. Rabies Booster Shot">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Due Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control" formControlName="due_date">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Frequency</label>
                <select class="form-select" formControlName="frequency">
                  <option value="One-time">One-time</option>
                  <option value="Daily">Daily</option>
                  <option value="Weekly">Weekly</option>
                  <option value="Monthly">Monthly</option>
                </select>
              </div>

            </div>

            <!-- Action Buttons -->
            <div class="modal-actions">
              <button type="button" class="btn-cancel" (click)="closeEditAlertModal()">
                Cancel
              </button>
              <button type="button" class="btn-save" (click)="saveAlert()"
                [disabled]="alertForm.invalid || isSavingAlert">
                <span *ngIf="isSavingAlert" class="spinner-border spinner-border-sm me-2" role="status"></span>
                {{ isSavingAlert ? 'Saving...' : (editingAlert ? 'Update Alert' : 'Create Alert') }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Document View Modal -->
  <div class="modal" [class.show]="showViewModal" tabindex="-1" [attr.aria-hidden]="!showViewModal">

    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h2 class="modal-title">
            {{ selectedDoc?.document_type || 'Document Preview' }}
          </h2>
          <button type="button" class="btn-close" aria-label="Close" (click)="closeViewModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <div *ngIf="selectedDoc" class="document-view">

            <!-- Header with icon & title -->
            <div class="doc-header"
              style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid #f0f0f0; padding-bottom: 1rem;">
              <div class="doc-icon-wrapper" [ngClass]="getDocTypeClass(selectedDoc.document_type)"
                style="width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 2rem; background: #FFFDF5; color: #D4AF37; border: 1px solid rgba(212,175,55,0.2);">
                <i [class]="getDocTypeIcon(selectedDoc.document_type)"></i>
              </div>
              <div class="doc-info">
                <h3 class="doc-title" style="margin: 0; color: #2C2A24; font-size: 1.4rem;">{{
                  selectedDoc.document_title }}</h3>
                <p class="doc-subtitle" style="margin: 0; color: #8C7853;">{{ selectedDoc.document_type }}</p>
              </div>
            </div>

            <!-- Details Grid -->
            <div class="doc-details-grid">
              <div class="detail-card">
                <div class="detail-icon"><i class="far fa-file-alt"></i></div>
                <div class="detail-content">
                  <span class="detail-label">File Name</span>
                  <span class="detail-value">{{ selectedDoc.file_name || 'document.pdf' }}</span>
                </div>
              </div>

              <div class="detail-card">
                <div class="detail-icon"><i class="fas fa-weight-hanging"></i></div>
                <div class="detail-content">
                  <span class="detail-label">File Size</span>
                  <span class="detail-value">{{ selectedDoc.file_size || 'N/A' }}</span>
                </div>
              </div>

              <div class="detail-card" *ngIf="selectedDoc.expiry_date">
                <div class="detail-icon"><i class="far fa-calendar-times"></i></div>
                <div class="detail-content">
                  <span class="detail-label">Expiry Date</span>
                  <span class="detail-value" [ngClass]="{
                    'text-danger': isDocumentExpired(selectedDoc),
                    'text-warning': isDocumentExpiring(selectedDoc)
                  }">
                    {{ selectedDoc.expiry_date | date:'dd MMM yyyy' }}
                    <span *ngIf="isDocumentExpired(selectedDoc)" class="badge expired-badge">Expired</span>
                    <span *ngIf="isDocumentExpiring(selectedDoc)" class="badge expiring-badge">Expiring Soon</span>
                  </span>
                </div>
              </div>

              <div class="detail-card">
                <div class="detail-icon"><i class="far fa-clock"></i></div>
                <div class="detail-content">
                  <span class="detail-label">Uploaded On</span>
                  <span class="detail-value">{{ selectedDoc.upload_date | date:'dd MMM yyyy' }}</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="doc-actions"
              style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #f0f0f0;">
              <button class="action-btn" style="flex: 1; border-radius: 8px; width: auto; font-weight: 600;"
                (click)="selectedDoc && downloadDocument(selectedDoc)">
                <i class="fas fa-download"></i>
                Download
              </button>

              <button class="action-btn" style="flex: 1; border-radius: 8px; width: auto; font-weight: 600;"
                (click)="selectedDoc && setAlertForDocument(selectedDoc)">
                <i class="fas fa-bell"></i>
                Reminder
              </button>

              <button class="btn-delete" style="flex: 1; border-radius: 8px;"
                (click)="selectedDoc && deleteDocument(selectedDoc.document_id)">
                <i class="fas fa-trash-alt"></i>
                Delete
              </button>
            </div>

          </div>

          <!-- Loading / no doc fallback -->
          <div *ngIf="!selectedDoc" class="text-center py-5">
            <div class="spinner-border text-warning" role="status"></div>
            <p class="mt-3 text-muted">Loading document details...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop" [class.show]="showUploadModal || showEditAlertModal || showViewModal"
    (click)="closeAllModals()"></div>
</div>