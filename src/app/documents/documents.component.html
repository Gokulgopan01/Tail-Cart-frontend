<div class="documents-container">
  <!-- Header with Stats -->
  <section class="documents-header">
    <div class="container">
      <div class="header-content">
        <div class="header-text">
          
          
          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon bg-primary">
                <i class="fas fa-file-alt"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ documents.length }}</div>
                <div class="stat-label">Documents</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon bg-warning">
                <i class="fas fa-bell"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getUpcomingAlertsCount() }}</div>
                <div class="stat-label">Upcoming Alerts</div>
              </div>
            </div>
            
            <div *ngIf="criticalAlerts.length > 0" class="stat-card">
              <div class="stat-icon bg-danger">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ criticalAlerts.length }}</div>
                <div class="stat-label">Critical</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="header-actions">
        <!-- First row - 2 buttons side by side -->
        <div class="action-buttons-row">
          <button class="action-btn btn-upload" (click)="openUploadModal()">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>Upload Document</span>
          </button>
          <button class="action-btn btn-alert" (click)="openCreateAlertModal()">
            <i class="fas fa-bell"></i>
            <span>Create Alert</span>
          </button>
        </div>
        
        <!-- Second row - Single centered button -->
        <div class="action-button-center">
          <button class="action-btn btn-view-alerts" (click)="toggleAlertsModal()">
            <i class="fas fa-list-ul"></i>
            <span>View Alerts</span>
            <span *ngIf="getUpcomingAlertsCount() > 0" class="alert-badge">
              {{ getUpcomingAlertsCount() }}
            </span>
          </button>
        </div>
      </div>

      </div>
    </div>
  </section>

  <!-- Critical Alerts Banner -->
  <div *ngIf="criticalAlerts.length > 0" class="critical-alerts-banner">
    <div class="container">
      <div class="banner-content">
        <div class="d-flex align-items-center gap-3">
          <i class="fas fa-exclamation-triangle fa-2x"></i>
          <div>
            <h5 class="mb-0 fw-bold">Critical Alerts</h5>
            <p class="mb-0">You have {{criticalAlerts.length}} urgent alert{{criticalAlerts.length > 1 ? 's' : ''}} requiring attention</p>
          </div>
        </div>
        <button class="btn btn-light btn-sm" (click)="toggleAlertsModal()">
          View Details
        </button>
      </div>
    </div>
  </div>

  <!-- Documents Grid -->
  <section class="documents-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Your Documents</h2>
        <p class="section-subtitle">Manage all your pet's important records</p>
      </div>

      <div *ngIf="documents.length > 0; else emptyState" class="documents-grid">
        <div class="row">
          <div *ngFor="let doc of documents" class="col-12 col-md-6 col-lg-4">
            <div class="document-card-modern">
              <div class="document-card-header">
                <div class="document-type">
                  <i class="fas fa-file-medical"></i>
                  <span>Medical</span>
                </div>
                <div class="document-actions">
                  <button class="btn-action" (click)="downloadDocument(doc)" matTooltip="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-action" (click)="deleteDocument(doc.document_id)" matTooltip="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              
              <div class="document-card-body">
                <h5 class="document-title">{{ doc.document_title }}</h5>
                <div class="document-meta">
                  <div class="meta-item">
                    <i class="fas fa-paw"></i>
                    <span>{{ getPetNameById(doc.pet) || 'Unknown Pet' }}</span>
                  </div>
                  <div class="meta-item">
                    <i class="far fa-calendar"></i>
                    <span>{{ doc.upload_date | date:'MMM dd, yyyy' }}</span>
                  </div>
                </div>
              </div>
              
              <div class="document-card-footer">
                <button class="btn btn-outline-primary" (click)="openAlertFormForDocument(doc)">
                  <i class="fas fa-bell"></i> Set Alert
                </button>
                <button class="btn btn-primary" (click)="previewDocument(doc)">
                  <i class="fas fa-eye"></i> View
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #emptyState>
        <div class="empty-state-modern">
          <div class="empty-state-icon">
            <i class="fas fa-folder-open"></i>
          </div>
          <h3>No Documents Yet</h3>
          <p class="text-muted">Upload your first document to get started</p>
          <button class="btn btn-primary" (click)="openUploadModal()">
            <i class="fas fa-plus"></i> Upload First Document
          </button>
        </div>
      </ng-template>
    </div>
  </section>

  <!-- Recent Alerts -->
  <section class="alerts-preview-section" *ngIf="alerts.length > 0">
    <div class="container">
      <div class="section-header">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="section-title">Recent Alerts</h2>
            <p class="section-subtitle">Upcoming reminders for your pets</p>
          </div>
          <button class="btn btn-outline-primary" (click)="toggleAlertsModal()">
            View All Alerts
          </button>
        </div>
      </div>

      <div class="alerts-grid">
        <div class="row">
          <div *ngFor="let alert of alerts.slice(0, 3)" class="col-12 col-md-4">
            <div class="alert-card-modern">
              <div class="alert-header">
                <div class="alert-icon" [ngClass]="getAlertIconClass(alert.alert_type)">
                  <i [class]="getAlertIcon(alert.alert_type)"></i>
                </div>
                <div class="badge" [ngClass]="getDaysRemainingClass(alert)">
                  {{ getDaysRemaining(alert) }}
                </div>
              </div>
              
              <div class="alert-body">
                <h5 class="alert-title">{{ alert.title }}</h5>
                <div class="alert-meta">
                  <span class="badge" [ngClass]="getAlertBadgeClass(alert.alert_type)">
                    {{ alert.alert_type }}
                  </span>
                </div>
                <p class="alert-date">
                  <i class="far fa-calendar"></i>
                  Due: {{ alert.due_date | date:'MMM dd, yyyy' }}
                </p>
              </div>
              
              <div class="alert-footer">
                <button class="btn btn-sm btn-outline-primary" (click)="editAlert(alert)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteAlert(alert.alert_id)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Upload Document Modal -->
<div class="modal" [class.show]="showUploadModal" tabindex="-1" 
     [attr.aria-hidden]="!showUploadModal" [style.display]="showUploadModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-cloud-upload-alt"></i>
          Upload Document
        </h2>
        <button type="button" class="btn-close" (click)="closeUploadModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label class="form-label">Document Title</label>
            <input type="text" class="form-control" formControlName="document_title" 
                   placeholder="e.g., Annual Vaccination Record">
          </div>
          
          <div class="form-group">
            <label class="form-label">Select Pet</label>
            <select class="form-select" formControlName="pet">
              <option value="">Choose a pet</option>
              <option *ngFor="let pet of userPets" [value]="pet.pet_id">
                {{ pet.pet_name }} ({{ pet.species }})
              </option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Upload File</label>
            <div class="file-upload-modern" (click)="fileInput.click()">
              <input type="file" #fileInput (change)="onFileSelected($event)" class="d-none">
              <div class="upload-area" [class.has-file]="selectedFile">
                <i class="fas fa-cloud-upload-alt fa-2x mb-3"></i>
                <h5>Click to upload</h5>
                <p class="text-muted">Supports PDF, DOC, JPG, PNG up to 10MB</p>
                <div *ngIf="selectedFile" class="file-preview">
                  <i class="fas fa-file-pdf text-danger"></i>
                  <div>
                    <strong>{{ selectedFile.name }}</strong>
                    <small>{{ (selectedFile.size / 1024).toFixed(0) }} KB</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeUploadModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="uploadForm.invalid || isUploading">
              <span *ngIf="isUploading" class="spinner-border spinner-border-sm me-2"></span>
              {{ isUploading ? 'Uploading...' : 'Upload Document' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Create Alert Modal -->
<div class="modal" [class.show]="showCreateAlertModal" tabindex="-1" 
     [attr.aria-hidden]="!showCreateAlertModal" [style.display]="showCreateAlertModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-bell"></i>
          Create Alert
        </h2>
        <button type="button" class="btn-close" (click)="closeCreateAlertModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="alertForm" (ngSubmit)="createAlert()">
          <div class="form-group">
            <label class="form-label">Alert Title</label>
            <input type="text" class="form-control" formControlName="title" 
                   placeholder="e.g., Annual Checkup">
          </div>
          
          <div class="form-group">
            <label class="form-label">Select Pet</label>
            <select class="form-select" formControlName="pet">
              <option value="">Choose a pet</option>
              <option *ngFor="let pet of userPets" [value]="pet.pet_id">
                {{ pet.pet_name }} ({{ pet.species }})
              </option>
            </select>
          </div>
          
          <div class="row g-2">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Type</label>
                <select class="form-select" formControlName="alert_type">
                  <option value="">Select Type</option>
                  <option value="Vaccination">Vaccination</option>
                  <option value="Medication">Medication</option>
                  <option value="Appointment">Appointment</option>
                  <option value="Checkup">Checkup</option>
                </select>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Frequency</label>
                <select class="form-select" formControlName="frequency">
                  <option value="One-time">One-time</option>
                  <option value="Monthly">Monthly</option>
                  <option value="Yearly">Yearly</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Due Date</label>
            <input type="date" class="form-control" formControlName="due_date" [min]="today">
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeCreateAlertModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="alertForm.invalid || isCreatingAlert">
              <span *ngIf="isCreatingAlert" class="spinner-border spinner-border-sm me-2"></span>
              {{ isCreatingAlert ? 'Creating...' : 'Create Alert' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Alerts Modal -->
<div class="modal" [class.show]="showAlertsModal" tabindex="-1" 
     [attr.aria-hidden]="!showAlertsModal" [style.display]="showAlertsModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-bell"></i>
          All Alerts
        </h2>
        <button type="button" class="btn-close" (click)="toggleAlertsModal()"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="loadingAlerts" class="text-center py-5">
          <div class="spinner-border text-primary"></div>
          <p>Loading alerts...</p>
        </div>
        
        <div *ngIf="!loadingAlerts && alerts.length === 0" class="text-center py-5">
          <i class="fas fa-bell-slash fa-2x text-muted mb-3"></i>
          <h4>No alerts yet</h4>
          <p class="text-muted">Create your first alert</p>
          <button class="btn btn-primary mt-3" (click)="openCreateAlertModal()">
            <i class="fas fa-plus"></i> Create Alert
          </button>
        </div>
        
        <div *ngIf="!loadingAlerts && alerts.length > 0" class="alerts-list-modern">
          <div *ngFor="let alert of alerts" class="alert-item">
            <div class="alert-item-icon" [ngClass]="getAlertIconClass(alert.alert_type)">
              <i [class]="getAlertIcon(alert.alert_type)"></i>
            </div>
            <div class="alert-item-content">
              <h5>{{ alert.title }}</h5>
              <div class="alert-item-meta">
                <span class="badge" [ngClass]="getAlertBadgeClass(alert.alert_type)">
                  {{ alert.alert_type }}
                </span>
                <span class="text-muted">
                  <i class="fas fa-paw"></i> {{ getPetNameById(alert.pet) }}
                </span>
                <span class="text-muted">
                  <i class="far fa-calendar"></i> {{ alert.due_date | date:'MMM dd' }}
                </span>
              </div>
            </div>
            <div class="alert-item-actions">
              <button class="btn btn-sm btn-outline-primary" (click)="editAlert(alert)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteAlert(alert.alert_id)">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="toggleAlertsModal()">Close</button>
        <button type="button" class="btn btn-primary" (click)="openCreateAlertModal()">
          <i class="fas fa-plus"></i> New Alert
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade" [class.show]="showUploadModal || showCreateAlertModal || showAlertsModal" 
     [style.display]="showUploadModal || showCreateAlertModal || showAlertsModal ? 'block' : 'none'"
     (click)="closeAllModals()"></div>