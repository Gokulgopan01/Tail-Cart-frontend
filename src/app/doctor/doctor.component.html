<div class="pet-care-assistant-container">

  <!-- Welcome / Landing Screen -->
  <div class="welcome-screen" *ngIf="showWelcomeScreen">
    <div class="welcome-content">
      <div class="welcome-header">
        <div class="welcome-logo">
          <i class="fas fa-paw"></i>
          <span>Pet AI Doctor</span>
        </div>
        <h1>Ask anything about your pet</h1>
        <p class="welcome-subtitle">
          Get helpful insights from an AI veterinary assistant â€” anytime, anywhere.
        </p>
      </div>

      <div class="example-prompts">
        <h3>Try asking about...</h3>
        <div class="prompts-grid">
          <button *ngFor="let prompt of examplePrompts" 
                  class="prompt-chip" 
                  (click)="useExamplePrompt(prompt)">
            {{ prompt.title }}
          </button>
        </div>
      </div>

      <div class="welcome-input-area">
        <div class="chat-input-wrapper">
          <textarea 
            #chatInput
            [(ngModel)]="userInput"
            (keydown)="onKeyPress($event)"
            (input)="adjustTextareaHeight()"
            placeholder="Ask about your pet's health, diet, behavior..."
            class="modern-chat-input"
            rows="1"
          ></textarea>
          <button class="send-button" 
                  (click)="askDoctor()" 
                  [disabled]="!userInput.trim()">
            <i class="fas fa-arrow-up"></i>
          </button>
        </div>
        <div class="disclaimer">
          <i class="fas fa-info-circle"></i>
          <span>Not a substitute for professional veterinary care</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Chat View -->
  <div class="chat-view" *ngIf="!showWelcomeScreen">
    <!-- Messages -->
    <div class="messages-container" #chatContainer (scroll)="onChatScroll()">
      <!-- Initial welcome message (only first time) -->
      <div class="message ai-message initial-welcome" *ngIf="showWelcomeInChat">
        <div class="avatar ai-avatar">
          <i class="fas fa-stethoscope"></i>
        </div>
        <div class="message-content">
          <div class="message-bubble">
            <h3>Hello! ðŸ‘‹ I'm your Pet AI Doctor</h3>
            <p>Ask me anything about your pet's health, nutrition, behavior, vaccinations, or general care.</p>
            <small>I'm not a vet â€” always consult a professional for serious concerns.</small>
          </div>
        </div>
      </div>

      <!-- Chat messages -->
      <ng-container *ngFor="let msg of messages; let i = index">
        <div class="message" 
             [ngClass]="{'user-message': msg.sender === 'user', 'ai-message': msg.sender === 'ai'}"
             [@messageAnimation]>
          
          <div class="avatar" [ngClass]="msg.sender === 'user' ? 'user-avatar' : 'ai-avatar'">
            <i class="fas" [ngClass]="msg.sender === 'user' ? 'fa-user' : 'fa-stethoscope'"></i>
          </div>

          <div class="message-content">
            <div class="message-bubble" 
                 [innerHTML]="msg.sender === 'ai' ? formatMessage(msg.text) : msg.text">
            </div>
            <div class="message-time">
              {{ msg.timestamp | date:'shortTime' }}
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Typing indicator -->
      <div class="message ai-message" *ngIf="isAiTyping" [@messageAnimation]>
        <div class="avatar ai-avatar">
          <i class="fas fa-stethoscope"></i>
        </div>
        <div class="message-content">
          <div class="message-bubble typing">
            <div class="typing-dots">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input area (fixed at bottom) -->
    <div class="chat-input-area">
      <div class="chat-input-wrapper">
        <textarea 
          #chatInput
          [(ngModel)]="userInput"
          (keydown)="onKeyPress($event)"
          (input)="adjustTextareaHeight()"
          placeholder="Ask anything about your pet..."
          class="modern-chat-input"
          rows="1"
        ></textarea>
        <button class="send-button" 
                (click)="askDoctor()" 
                [disabled]="!userInput.trim() || isAiTyping">
          <i class="fas fa-arrow-up"></i>
        </button>
      </div>
      <div class="disclaimer bottom">
        <i class="fas fa-shield-alt"></i>
        <span>AI-generated â€¢ Not veterinary advice</span>
      </div>
    </div>

    <!-- Clear chat button -->
    <button class="clear-chat-floating" 
            *ngIf="messages.length > 2"
            (click)="clearChat()">
      <i class="fas fa-trash-can"></i>
    </button>
  </div>
</div>