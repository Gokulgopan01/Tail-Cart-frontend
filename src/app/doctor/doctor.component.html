<div class="doctor-ai-page">
  <!-- Interactive Header -->
  <header class="doctor-header glass-effect">
    <div class="container header-content">
      <div class="doctor-branding">
        <div class="doctor-avatar-wrapper">
          <div class="doctor-avatar pulse-glow">
            <i class="fas fa-user-md"></i>
            <div class="online-indicator"></div>
          </div>
        </div>
        <div class="doctor-info">
          <h1 class="doctor-name">Dr. Pawfect</h1>
          <p class="doctor-status">Specializing in Pet Wellness & Care</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="action-btn" (click)="clearChat()" title="Start New Consultation">
          <i class="fas fa-plus"></i> <span class="hide-mobile">New Consultation</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Welcome / Landing State -->
  <div class="welcome-section" *ngIf="showWelcomeScreen">
    <div class="container welcome-card luxury-fade-in">
      <div class="hero-image">
        <div class="doctor-illustration">
          <!-- High-quality vet icon concept -->
          <i class="fas fa-stethoscope main-icon"></i>
          <div class="floating-icons">
            <i class="fas fa-heart"></i>
            <i class="fas fa-dog"></i>
            <i class="fas fa-cat"></i>
          </div>
        </div>
      </div>
      <h2 class="welcome-title">How can I help your pet today?</h2>
      <p class="welcome-desc">Get instant, AI-powered veterinary guidance and wellness tips.</p>

      <div class="suggested-prompts">
        <button *ngFor="let prompt of examplePrompts" class="suggested-btn" (click)="useExamplePrompt(prompt)">
          <div class="prompt-icon"><i
              [class]="'fas ' + (prompt.category === 'health' ? 'fa-medkit' : prompt.category === 'nutrition' ? 'fa-bone' : 'fa-paw')"></i>
          </div>
          <div class="prompt-text">
            <strong>{{ prompt.title }}</strong>
            <span>{{ prompt.subtitle }}</span>
          </div>
        </button>
      </div>

      <div class="welcome-input-wrapper">
        <div class="input-container glass-input">
          <textarea #chatInput [(ngModel)]="userInput" (keydown)="onKeyPress($event)" (input)="adjustTextareaHeight()"
            placeholder="Describe your pet's symptoms or ask a question..." class="luxury-textarea" rows="1"></textarea>
          <button class="btn-send" (click)="askDoctor()" [disabled]="!userInput.trim()">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        <p class="disclaimer-text"><i class="fas fa-shield-alt"></i> Not a substitute for professional veterinary
          advice.</p>
      </div>
    </div>
  </div>

  <!-- Active Chat View -->
  <div class="chat-viewport" *ngIf="!showWelcomeScreen">
    <div class="messages-container" #chatContainer (scroll)="onChatScroll()">
      <!-- Consultation Start Notice -->
      <div class="consultation-start">
        <span *ngIf="messages.length">
          Started on {{ messages[0].timestamp | date:'MMMM d, h:mm a' }}
        </span>
      </div>

      <ng-container *ngFor="let msg of messages; let i = index">
        <div class="message-wrapper" [ngClass]="msg.sender">
          <div class="message-avatar" *ngIf="msg.sender === 'ai'">
            <i class="fas fa-user-md"></i>
          </div>
          <div class="message-bubble-container">
            <div class="message-bubble" [innerHTML]="formatMessage(msg.text)"></div>
            <span class="message-time">{{ msg.timestamp | date:'h:mm a' }}</span>
          </div>
        </div>
      </ng-container>

      <!-- Thinking State (Pulsing Indicator) -->
      <div class="message-wrapper ai" *ngIf="isThinking">
        <div class="message-avatar thinking-pulse">
          <i class="fas fa-user-md"></i>
        </div>
        <div class="message-bubble-container">
          <div class="message-bubble thinking-bubble">
            <div class="thinking-dots">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Typing State (Simulated Typing in simulateTyping() logic already updates messages) -->
    </div>

    <!-- Sticky Chat Input -->
    <div class="sticky-footer glass-effect">
      <div class="container footer-content">
        <div class="input-container sticky-input">
          <textarea #chatInput [(ngModel)]="userInput" (keydown)="onKeyPress($event)" (input)="adjustTextareaHeight()"
            placeholder="Type your follow-up question here..." class="luxury-textarea" rows="1"></textarea>
          <button class="btn-send" (click)="askDoctor()" [disabled]="!userInput.trim() || isThinking || isAiTyping">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        <div class="footer-meta">
          <span class="ai-badge"><i class="fas fa-bolt"></i> Powered by Gemini AI</span>
          <span class="vet-notice">Emergency? Contact your local vet immediately.</span>
        </div>
      </div>
    </div>
  </div>
</div>